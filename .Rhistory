warning(paste("Error reading file:", file, "-", e$message))
return(NULL)
})
})
names(ifr_dfs) <- basename(ifr_files)
ifr_dfs <- ifr_dfs[!sapply(ifr_dfs, is.null)]  # Remove any NULL entries (failed reads)
ifr_dfs <- lapply(names(ifr_dfs), function(name) {
tryCatch({
df <- ifr_dfs[[name]]
df %>%
mutate(
df_name = name,
Int. = as.numeric(as.character(ifelse(Int. %in% c("N/A", "-"), NA, Int.))),
`Ref. date` = as.numeric(`Ref. date`)
) %>%
filter(`Ref. date` %in% c(1950, 2010, 2019))
}, error = function(e) {
message(paste("Error in processing file:", name))
message("Error message:", e$message)
return(NULL)  # Return NULL for this iteration if there's an error
})
})
ifr_df <- bind_rows(ifr_dfs) %>%
filter(!is.na(`Std. err`) & !Name %in% c("Census 2010 (Household Deaths)", "Demographic and Health Survey 2013 (Direct)", "VR from Oficina Nacional de Estadistica 2021 (VR)", "Encuesta Nacional de la Dinamica Demografica (ENADID) 2018 (Direct)", "Vital Registration data from Mexico Ministry of Health 2018 (VR)")) %>%
mutate(country = case_when(
#df_name == "PRI-Infant mortality rate-Total-datasources-download.csv" ~ "Puerto Rico",
df_name == "CAN-Infant mortality rate-Total-datasources-download.csv" ~ "Canada",
df_name == "MEX-Infant mortality rate-Total-datasources-download.csv" ~ "Mexico",
df_name == "BLZ-Infant mortality rate-Total-datasources-download.csv" ~ "Belize",
df_name == "CRI-Infant mortality rate-Total-datasources-download.csv" ~ "Costa Rica",
df_name == "SLV-Infant mortality rate-Total-datasources-download.csv" ~ "El Salvador",
df_name == "GTM-Infant mortality rate-Total-datasources-download.csv" ~ "Guatemala",
df_name == "HND-Infant mortality rate-Total-datasources-download.csv" ~ "Honduras",
df_name == "NIC-Infant mortality rate-Total-datasources-download.csv" ~ "Nicaragua",
df_name == "PAN-Infant mortality rate-Total-datasources-download.csv" ~ "Panama",
df_name == "CUB-Infant mortality rate-Total-datasources-download.csv" ~ "Cuba",
df_name == "DOM-Infant mortality rate-Total-datasources-download.csv" ~ "Dominican Republic",
df_name == "HTI-Infant mortality rate-Total-datasources-download.csv" ~ "Haiti",
df_name == "JAM-Infant mortality rate-Total-datasources-download.csv" ~ "Jamaica",
df_name == "DMA-Infant mortality rate-Total-datasources-download.csv" ~ "Dominica",
df_name == "TTO-Infant mortality rate-Total-datasources-download.csv" ~ "Trinidad and Tobago",
df_name == "ARG-Infant mortality rate-Total-datasources-download.csv" ~ "Argentina",
df_name == "BOL-Infant mortality rate-Total-datasources-download.csv" ~ "Bolivia",
df_name == "BRA-Infant mortality rate-Total-datasources-download.csv" ~ "Brazil",
df_name == "CHL-Infant mortality rate-Total-datasources-download.csv" ~ "Chile",
df_name == "COL-Infant mortality rate-Total-datasources-download.csv" ~ "Colombia",
df_name == "ECU-Infant mortality rate-Total-datasources-download.csv" ~ "Ecuador",
df_name == "GUY-Infant mortality rate-Total-datasources-download.csv" ~ "Guyana",
df_name == "PRY-Infant mortality rate-Total-datasources-download.csv" ~ "Paraguay",
df_name == "PER-Infant mortality rate-Total-datasources-download.csv" ~ "Peru",
df_name == "URY-Infant mortality rate-Total-datasources-download.csv" ~ "Uruguay",
df_name == "VEN-Infant mortality rate-Total-datasources-download.csv" ~ "Venezuela",
TRUE ~ "Unknown"  # This will catch any unmatched file names
)) %>%
select(Value, `Ref. date`, country) %>%
mutate(Value = as.character(Value)) %>%
add_row(Value = "6.861", `Ref. date` = 2010, country = "Puerto Rico") %>%
add_row(Value = "70.531", `Ref. date` = 1950, country = "Puerto Rico") %>%
add_row(Value = "5.309", `Ref. date` = 2019, country = "Puerto Rico") %>%
add_row(Value = "87.121", `Ref. date` = 1950, country = "Cuba") %>%
rename(ifr = Value,
ifr_year = `Ref. date`) %>%
slice(-2)
rm(ifr_path, ifr_files)
ifr_2010 <- ifr_df %>%
filter(ifr_year == 2010) %>%
rename(ifr_2010 = ifr) %>%
select(-ifr_year)
ifr_1950 <- ifr_df %>%
filter(ifr_year == 1950) %>%
rename(ifr_1950 = ifr) %>%
select(-ifr_year)
ifr_2019 <- ifr_df %>%
filter(ifr_year == 2019) %>%
rename(ifr_2019 = ifr) %>%
select(-ifr_year)
#merging all background data into one df
background_data <- left_join(e60, gdp, by = "country")
background_data <- left_join(background_data, ifr_2010, by = "country")
background_data <- left_join(background_data, ifr_1950, by = "country")
background_data <- left_join(background_data, ifr_2019, by = "country")
background_data <- background_data %>%
arrange(desc(ifr_2010)) %>%
distinct(country, .keep_all = TRUE)
counts <- read.csv(paste0(data_dir,"hispanic_immigrant_count.csv")) %>%
select(bpld_string, count, percent) %>%
mutate(percent = percent*100) %>%
rename(country = bpld_string)
background_data <- left_join(background_data, counts, by = "country") %>%
arrange(country)
rm(ifr_2010, ifr_1950, ifr_2019, ifr_df, ifr_dfs, gdp, e60)
write.csv(background_data, paste0(out_dir,"../background_data.csv"))
create_table_for_sex_international <- function(sex_value) {
in_df %>%
filter(sex == sex_value) %>%
filter(!is.na(country_string)) %>%
group_by(country_string) %>%
summarise(
mean_age_60_69 = weighted.mean(age_60to69, perwt, na.rm = TRUE),
mean_age_70_79 = weighted.mean(age_70to79, perwt, na.rm = TRUE),
mean_age_80_89 = weighted.mean(age_80to89, perwt, na.rm = TRUE),
mean_age_90plus = weighted.mean(age_90plus, perwt, na.rm = TRUE),
mean_less_than_primary_completed = weighted.mean(less_than_primary_completed, perwt, na.rm = TRUE),
mean_primary_completed = weighted.mean(primary_completed, perwt, na.rm = TRUE),
mean_secondary_completed = weighted.mean(secondary_completed, perwt, na.rm = TRUE),
mean_university_completed = weighted.mean(university_completed, perwt, na.rm = TRUE),
mean_hhsize = weighted.mean(famsize, perwt, na.rm = TRUE),
mean_lives_alone = weighted.mean(lives_alone, perwt, na.rm = TRUE),
mean_has_child_in_hh = weighted.mean(child_in_household, perwt, na.rm = TRUE),
mean_married_cohab = weighted.mean(married_cohab, perwt, na.rm = TRUE),
N = n()
) %>%
pivot_longer(cols = -country_string, names_to = "variable", values_to = "value") %>%
pivot_wider(names_from = country_string, values_from = value) %>%
mutate(variable = recode(variable,
mean_age_60_69 = "60 - 69",
mean_age_70_79 = "70 - 79",
mean_age_80_89 = "80 - 89",
mean_age_90plus = "90 plus",
mean_married_cohab = "Married/Cohabiting",
mean_hhsize = "Household Size",
mean_lives_alone = "Lives Alone",
mean_has_child_in_hh = "Lives with Child",
mean_less_than_primary_completed = "Less than Primary",
mean_primary_completed = "Primary",
mean_secondary_completed = "Secondary",
mean_university_completed = "University"
))
}
table2_sex_1 <- create_table_for_sex_international(1)
table2_sex_2 <- create_table_for_sex_international(2)
combined_table2 <- bind_rows(
table2_sex_2, #females first
table2_sex_1 #males second
)
combined_table2 <- combined_table2 %>%
mutate(across(where(is.numeric), round, digits = 2)) %>%
mutate(across(everything(), ~ as.character(.))) %>%
mutate(across(everything(), ~ ifelse(. == "NaN", "-", .))) %>%
mutate(across(everything(), ~ ifelse(. == "0", "-", .))) %>%
rename(Demographics = variable)
#adding in the US born counterparts
create_table_for_sex_us_counterparts <- function(sex_value) {
us_df_2010 %>%
filter(sex == sex_value) %>%
filter(country_string %in% c("mexico", "dominican republic", "cuba", "puerto rico")) %>%
group_by(country_string) %>%
summarise(
mean_age_60_69 = weighted.mean(age_60to69, perwt, na.rm = TRUE),
mean_age_70_79 = weighted.mean(age_70to79, perwt, na.rm = TRUE),
mean_age_80_89 = weighted.mean(age_80to89, perwt, na.rm = TRUE),
mean_age_90plus = weighted.mean(age_90plus, perwt, na.rm = TRUE),
mean_less_than_primary_completed = weighted.mean(less_than_primary_completed, perwt, na.rm = TRUE),
mean_primary_completed = weighted.mean(primary_completed, perwt, na.rm = TRUE),
mean_secondary_completed = weighted.mean(secondary_completed, perwt, na.rm = TRUE),
mean_university_completed = weighted.mean(university_completed, perwt, na.rm = TRUE),
mean_hhsize = weighted.mean(famsize, perwt, na.rm = TRUE),
mean_lives_alone = weighted.mean(lives_alone, perwt, na.rm = TRUE),
mean_has_child_in_hh = weighted.mean(child_in_household, perwt, na.rm = TRUE),
mean_married_cohab = weighted.mean(married_cohab, perwt, na.rm = TRUE),
N = n()
) %>%
pivot_longer(cols = -country_string, names_to = "variable", values_to = "value") %>%
pivot_wider(names_from = country_string, values_from = value) %>%
mutate(variable = recode(variable,
mean_age_60_69 = "60 - 69",
mean_age_70_79 = "70 - 79",
mean_age_80_89 = "80 - 89",
mean_age_90plus = "90 plus",
mean_married_cohab = "Married/Cohabiting",
mean_hhsize = "Household Size",
mean_lives_alone = "Lives Alone",
mean_has_child_in_hh = "Lives with Child",
mean_less_than_primary_completed = "Less than Primary",
mean_primary_completed = "Primary",
mean_secondary_completed = "Secondary",
mean_university_completed = "University"
))
}
table2_sex_1_us <- create_table_for_sex_us_counterparts(1)
table2_sex_2_us <- create_table_for_sex_us_counterparts(2)
combined_table2 <- bind_rows(
table2_sex_2_us, #females first
table2_sex_1_us #males second
)
combined_table2 <- combined_table2 %>%
mutate(across(where(is.numeric), round, digits = 2)) %>%
mutate(across(everything(), ~ as.character(.))) %>%
mutate(across(everything(), ~ ifelse(. == "NaN", "-", .))) %>%
mutate(across(everything(), ~ ifelse(. == "0", "-", .))) %>%
select(-variable)
table2 <- cbind(combined_table2, combined_table2) %>%
rename(`US Mexican-born` = mexico,
`US Puerto-Rican-born` = `puerto rico`,
`US Dominican-born` = `dominican republic`,
`US Cuban-born` = cuba,
`Cubans`  = Cuba,
`Dominicans`  = DR,
`Mexicans`  = Mexico,
`Puerto Ricans`  = PR,
`All US Residents` = US
) %>%
select(
Demographics,
`Mexicans`, `US Mexican-born`,
`Puerto Ricans`, `US Puerto-Rican-born`,
`Dominicans`, `US Dominican-born`,
`Cubans`, `US Cuban-born`
) %>%
add_row(Demographics = "Age", .before = 1) %>%
add_row(Demographics = "Education Completed", .before = 6) %>%
add_row(Demographics = "Household", .before = 11) %>%
add_row(Demographics = "Age", .before = 17) %>%
add_row(Demographics = "Education Completed", .before = 22) %>%
add_row(Demographics = "Household", .before = 27) %>%
mutate(Gender = ifelse(row_number() == 1, "Female",
ifelse(row_number() == 17, "Male", ""))) %>%
select(Gender, everything())
create_table_for_sex_international <- function(sex_value) {
in_df %>%
filter(sex == sex_value) %>%
filter(!is.na(country_string)) %>%
group_by(country_string) %>%
summarise(
mean_age_60_69 = weighted.mean(age_60to69, perwt, na.rm = TRUE),
mean_age_70_79 = weighted.mean(age_70to79, perwt, na.rm = TRUE),
mean_age_80_89 = weighted.mean(age_80to89, perwt, na.rm = TRUE),
mean_age_90plus = weighted.mean(age_90plus, perwt, na.rm = TRUE),
mean_less_than_primary_completed = weighted.mean(less_than_primary_completed, perwt, na.rm = TRUE),
mean_primary_completed = weighted.mean(primary_completed, perwt, na.rm = TRUE),
mean_secondary_completed = weighted.mean(secondary_completed, perwt, na.rm = TRUE),
mean_university_completed = weighted.mean(university_completed, perwt, na.rm = TRUE),
mean_hhsize = weighted.mean(famsize, perwt, na.rm = TRUE),
mean_lives_alone = weighted.mean(lives_alone, perwt, na.rm = TRUE),
mean_has_child_in_hh = weighted.mean(child_in_household, perwt, na.rm = TRUE),
mean_married_cohab = weighted.mean(married_cohab, perwt, na.rm = TRUE),
N = n()
) %>%
pivot_longer(cols = -country_string, names_to = "variable", values_to = "value") %>%
pivot_wider(names_from = country_string, values_from = value) %>%
mutate(variable = recode(variable,
mean_age_60_69 = "60 - 69",
mean_age_70_79 = "70 - 79",
mean_age_80_89 = "80 - 89",
mean_age_90plus = "90 plus",
mean_married_cohab = "Married/Cohabiting",
mean_hhsize = "Household Size",
mean_lives_alone = "Lives Alone",
mean_has_child_in_hh = "Lives with Child",
mean_less_than_primary_completed = "Less than Primary",
mean_primary_completed = "Primary",
mean_secondary_completed = "Secondary",
mean_university_completed = "University"
))
}
table2_sex_1 <- create_table_for_sex_international(1)
table2_sex_2 <- create_table_for_sex_international(2)
combined_table2 <- bind_rows(
table2_sex_2, #females first
table2_sex_1 #males second
)
combined_table2 <- combined_table2 %>%
mutate(across(where(is.numeric), round, digits = 2)) %>%
mutate(across(everything(), ~ as.character(.))) %>%
mutate(across(everything(), ~ ifelse(. == "NaN", "-", .))) %>%
mutate(across(everything(), ~ ifelse(. == "0", "-", .))) %>%
rename(Demographics = variable)
#adding in the US born counterparts
create_table_for_sex_us_counterparts <- function(sex_value) {
us_df_2010 %>%
filter(sex == sex_value) %>%
filter(country_string %in% c("mexico", "dominican republic", "cuba", "puerto rico")) %>%
group_by(country_string) %>%
summarise(
mean_age_60_69 = weighted.mean(age_60to69, perwt, na.rm = TRUE),
mean_age_70_79 = weighted.mean(age_70to79, perwt, na.rm = TRUE),
mean_age_80_89 = weighted.mean(age_80to89, perwt, na.rm = TRUE),
mean_age_90plus = weighted.mean(age_90plus, perwt, na.rm = TRUE),
mean_less_than_primary_completed = weighted.mean(less_than_primary_completed, perwt, na.rm = TRUE),
mean_primary_completed = weighted.mean(primary_completed, perwt, na.rm = TRUE),
mean_secondary_completed = weighted.mean(secondary_completed, perwt, na.rm = TRUE),
mean_university_completed = weighted.mean(university_completed, perwt, na.rm = TRUE),
mean_hhsize = weighted.mean(famsize, perwt, na.rm = TRUE),
mean_lives_alone = weighted.mean(lives_alone, perwt, na.rm = TRUE),
mean_has_child_in_hh = weighted.mean(child_in_household, perwt, na.rm = TRUE),
mean_married_cohab = weighted.mean(married_cohab, perwt, na.rm = TRUE),
N = n()
) %>%
pivot_longer(cols = -country_string, names_to = "variable", values_to = "value") %>%
pivot_wider(names_from = country_string, values_from = value) %>%
mutate(variable = recode(variable,
mean_age_60_69 = "60 - 69",
mean_age_70_79 = "70 - 79",
mean_age_80_89 = "80 - 89",
mean_age_90plus = "90 plus",
mean_married_cohab = "Married/Cohabiting",
mean_hhsize = "Household Size",
mean_lives_alone = "Lives Alone",
mean_has_child_in_hh = "Lives with Child",
mean_less_than_primary_completed = "Less than Primary",
mean_primary_completed = "Primary",
mean_secondary_completed = "Secondary",
mean_university_completed = "University"
))
}
table2_sex_1_us <- create_table_for_sex_us_counterparts(1)
table2_sex_2_us <- create_table_for_sex_us_counterparts(2)
combined_table2 <- bind_rows(
table2_sex_2_us, #females first
table2_sex_1_us #males second
)
combined_table2 <- combined_table2 %>%
mutate(across(where(is.numeric), round, digits = 2)) %>%
mutate(across(everything(), ~ as.character(.))) %>%
mutate(across(everything(), ~ ifelse(. == "NaN", "-", .))) %>%
mutate(across(everything(), ~ ifelse(. == "0", "-", .))) %>%
select(-variable)
table2 <- cbind(combined_table2, combined_table2) %>%
rename(`US Mexican-born` = mexico,
`US Puerto-Rican-born` = `puerto rico`,
`US Dominican-born` = `dominican republic`,
`US Cuban-born` = cuba,
`Cubans`  = Cuba,
`Dominicans`  = DR,
`Mexicans`  = Mexico,
`Puerto Ricans`  = PR,
`All US Residents` = US
) %>%
select(
Demographics,
`Mexicans`, `US Mexican-born`,
`Puerto Ricans`, `US Puerto-Rican-born`,
`Dominicans`, `US Dominican-born`,
`Cubans`, `US Cuban-born`
) %>%
add_row(Demographics = "Age", .before = 1) %>%
add_row(Demographics = "Education Completed", .before = 6) %>%
add_row(Demographics = "Household", .before = 11) %>%
add_row(Demographics = "Age", .before = 17) %>%
add_row(Demographics = "Education Completed", .before = 22) %>%
add_row(Demographics = "Household", .before = 27) %>%
mutate(Gender = ifelse(row_number() == 1, "Female",
ifelse(row_number() == 17, "Male", ""))) %>%
select(Gender, everything())
create_table_for_sex_international <- function(sex_value) {
in_df %>%
filter(sex == sex_value) %>%
filter(!is.na(country_string)) %>%
group_by(country_string) %>%
summarise(
mean_age_60_69 = weighted.mean(age_60to69, perwt, na.rm = TRUE),
mean_age_70_79 = weighted.mean(age_70to79, perwt, na.rm = TRUE),
mean_age_80_89 = weighted.mean(age_80to89, perwt, na.rm = TRUE),
mean_age_90plus = weighted.mean(age_90plus, perwt, na.rm = TRUE),
mean_less_than_primary_completed = weighted.mean(less_than_primary_completed, perwt, na.rm = TRUE),
mean_primary_completed = weighted.mean(primary_completed, perwt, na.rm = TRUE),
mean_secondary_completed = weighted.mean(secondary_completed, perwt, na.rm = TRUE),
mean_university_completed = weighted.mean(university_completed, perwt, na.rm = TRUE),
mean_hhsize = weighted.mean(famsize, perwt, na.rm = TRUE),
mean_lives_alone = weighted.mean(lives_alone, perwt, na.rm = TRUE),
mean_has_child_in_hh = weighted.mean(child_in_household, perwt, na.rm = TRUE),
mean_married_cohab = weighted.mean(married_cohab, perwt, na.rm = TRUE),
N = n()
) %>%
pivot_longer(cols = -country_string, names_to = "variable", values_to = "value") %>%
pivot_wider(names_from = country_string, values_from = value) %>%
mutate(variable = recode(variable,
mean_age_60_69 = "60 - 69",
mean_age_70_79 = "70 - 79",
mean_age_80_89 = "80 - 89",
mean_age_90plus = "90 plus",
mean_married_cohab = "Married/Cohabiting",
mean_hhsize = "Household Size",
mean_lives_alone = "Lives Alone",
mean_has_child_in_hh = "Lives with Child",
mean_less_than_primary_completed = "Less than Primary",
mean_primary_completed = "Primary",
mean_secondary_completed = "Secondary",
mean_university_completed = "University"
))
}
table1_sex_1 <- create_table_for_sex_international(1)
table1_sex_2 <- create_table_for_sex_international(2)
combined_table1 <- bind_rows(
table1_sex_2, #females first
table1_sex_1 #males second
)
combined_table1 <- combined_table1 %>%
mutate(across(where(is.numeric), round, digits = 2)) %>%
mutate(across(everything(), ~ as.character(.))) %>%
mutate(across(everything(), ~ ifelse(. == "NaN", "-", .))) %>%
mutate(across(everything(), ~ ifelse(. == "0", "-", .))) %>%
rename(Demographics = variable)
#adding in the US born counterparts
create_table_for_sex_us_counterparts <- function(sex_value) {
us_df_2010 %>%
filter(sex == sex_value) %>%
filter(country_string %in% c("mexico", "dominican republic", "cuba", "puerto rico")) %>%
group_by(country_string) %>%
summarise(
mean_age_60_69 = weighted.mean(age_60to69, perwt, na.rm = TRUE),
mean_age_70_79 = weighted.mean(age_70to79, perwt, na.rm = TRUE),
mean_age_80_89 = weighted.mean(age_80to89, perwt, na.rm = TRUE),
mean_age_90plus = weighted.mean(age_90plus, perwt, na.rm = TRUE),
mean_less_than_primary_completed = weighted.mean(less_than_primary_completed, perwt, na.rm = TRUE),
mean_primary_completed = weighted.mean(primary_completed, perwt, na.rm = TRUE),
mean_secondary_completed = weighted.mean(secondary_completed, perwt, na.rm = TRUE),
mean_university_completed = weighted.mean(university_completed, perwt, na.rm = TRUE),
mean_hhsize = weighted.mean(famsize, perwt, na.rm = TRUE),
mean_lives_alone = weighted.mean(lives_alone, perwt, na.rm = TRUE),
mean_has_child_in_hh = weighted.mean(child_in_household, perwt, na.rm = TRUE),
mean_married_cohab = weighted.mean(married_cohab, perwt, na.rm = TRUE),
N = n()
) %>%
pivot_longer(cols = -country_string, names_to = "variable", values_to = "value") %>%
pivot_wider(names_from = country_string, values_from = value) %>%
mutate(variable = recode(variable,
mean_age_60_69 = "60 - 69",
mean_age_70_79 = "70 - 79",
mean_age_80_89 = "80 - 89",
mean_age_90plus = "90 plus",
mean_married_cohab = "Married/Cohabiting",
mean_hhsize = "Household Size",
mean_lives_alone = "Lives Alone",
mean_has_child_in_hh = "Lives with Child",
mean_less_than_primary_completed = "Less than Primary",
mean_primary_completed = "Primary",
mean_secondary_completed = "Secondary",
mean_university_completed = "University"
))
}
table1_sex_1_us <- create_table_for_sex_us_counterparts(1)
table1_sex_2_us <- create_table_for_sex_us_counterparts(2)
combined_table2 <- bind_rows(
table1_sex_2_us, #females first
table1_sex_1_us #males second
)
combined_table2 <- combined_table2 %>%
mutate(across(where(is.numeric), round, digits = 2)) %>%
mutate(across(everything(), ~ as.character(.))) %>%
mutate(across(everything(), ~ ifelse(. == "NaN", "-", .))) %>%
mutate(across(everything(), ~ ifelse(. == "0", "-", .))) %>%
select(-variable)
table1 <- cbind(combined_table1, combined_table2) %>%
rename(`US Mexican-born` = mexico,
`US Puerto-Rican-born` = `puerto rico`,
`US Dominican-born` = `dominican republic`,
`US Cuban-born` = cuba,
`Cubans`  = Cuba,
`Dominicans`  = DR,
`Mexicans`  = Mexico,
`Puerto Ricans`  = PR,
`All US Residents` = US
) %>%
select(
Demographics,
`Mexicans`, `US Mexican-born`,
`Puerto Ricans`, `US Puerto-Rican-born`,
`Dominicans`, `US Dominican-born`,
`Cubans`, `US Cuban-born`
) %>%
add_row(Demographics = "Age", .before = 1) %>%
add_row(Demographics = "Education Completed", .before = 6) %>%
add_row(Demographics = "Household", .before = 11) %>%
add_row(Demographics = "Age", .before = 17) %>%
add_row(Demographics = "Education Completed", .before = 22) %>%
add_row(Demographics = "Household", .before = 27) %>%
mutate(Gender = ifelse(row_number() == 1, "Female",
ifelse(row_number() == 17, "Male", ""))) %>%
select(Gender, everything())
print(table1)
table1_code <- xtable(table1,
caption = "Summary Statistics by Country and Sex For Hispanics in Their Native Countries",
align = "lll|cccccccc")
latex_code <- capture.output(print(table1_code,
type = "latex",
caption.placement = "top",
size = "\\small",
include.rownames = FALSE))
tabular_line_index <- grep("\\\\begin\\{tabular\\}", latex_code)
latex_code[tabular_line_index] <- "\\begin{tabular}{l>{\\raggedright\\arraybackslash}p{3.2cm}|ccccccccc}"
adjustments <- list(
list(rows = c("60 - 69", "70 - 79", "80 - 89", "90 plus"), width = 1.5),
list(rows = c("Less than Primary"), width = 3.2),
list(rows = c("Primary"), width = 1.7),
list(rows = c("Secondary", "University"), width = 2),
list(rows = c("Less than 15"), width = 2.4),
list(rows = c("50 and Above", "Citizen"), width = 2.6),
list(rows = c("15 - 23", "24 - 49"), width = 1.6),
list(rows = c("Lives with Child"), width = 2.9),
list(rows = c("Before 1965"), width = 2.3),
list(rows = c("1965 - 1979", "1980 - 1999", "Lives Alone"), width = 2.2),
list(rows = c("After 1999"), width = 2.1),
list(rows = c("Household Size"), width = 2.7),
list(rows = c("English Speakers"), width = 3.0),
list(rows = c("Married/Cohabiting"), width = 3.4)
)
# Function to adjust LaTeX rows based on the adjustments list
adjust_latex_rows <- function(latex_code, adjustments) {
for (adjustment in adjustments) {
width <- adjustment$width
for (row in adjustment$rows) {
pattern <- paste0("(?<=[&|])\\s*", row, "(?=\\s*[&|])")
replacement <- paste0(" \\\\multicolumn{1}{>{\\\\raggedleft\\\\arraybackslash}p{", width, "cm}|}{\\\\makebox[", width, "cm][r]{", row, " }}")
latex_code <- gsub(pattern, replacement, latex_code, perl = TRUE)
}
}
return(latex_code)
}
latex_code <- adjust_latex_rows(latex_code, adjustments)
print(latex_code)
writeLines(latex_code, "/Users/chrissoria/Documents/Research/us_international_ses/tables/r_tables/table2.tex")
