results <- create_country_summary(country_coefs_interaction_no_cont, country_coefs_interaction)
results_male <- create_country_summary(male_country_coefs_interaction_no_cont, male_country_coefs_interaction)
results_female <- create_country_summary(female_country_coefs_interaction_no_cont, female_country_coefs_interaction)
country_change <- create_faceted_demo_plot2(results,
y_limits = c(-.1, .15)) +
geom_hline(yintercept = 0, linetype = "dashed")
country_change_male <- create_faceted_demo_plot2(results_male,
y_limits = c(-.1, .15)) +
geom_hline(yintercept = 0, linetype = "dashed")
country_change_female <- create_faceted_demo_plot2(results_female,
y_limits = c(-.1, .15)) +
geom_hline(yintercept = 0, linetype = "dashed")
plot_list <- list(
"country_levels_colors_change" = country_change,
"country_levels_male_colors_change" = country_change_male,
"country_levels_female_colors_change" = country_change_female
)
for (i in names(plot_list)) {
print(plot_list[[i]])
ggsave(
filename = file.path(plot_dir, paste0(i, ".pdf")),
plot = plot_list[[i]],
device = "pdf",
width = 9,
height = 10,
dpi = 300
)
}
create_faceted_demo_plot2 <- function(data,
adjusted_vars = c("adjusted_mean_less_than_primary_completed",
"adjusted_mean_secondary_or_above",
"adjusted_mean_lives_alone",
"adjusted_mean_married_cohab",
"adjusted_mean_is_naturalized_citizen",
"adjusted_mean_english_speaker"),
unadjusted_vars = c("mean_less_than_primary_completed",
"mean_secondary_completed",
"mean_lives_alone",
"mean_married_cohab",
"mean_is_citizen",
"mean_english_speaker"),
var_labels = c("Less than Primary",
"Secondary or Above",
"Lives Alone",
"Married/Cohabiting",
"Naturalized Citizen",
"English Speaker"),
country_var = "country_string",
title = element_blank(),
y_limits = c(0, .7)) {
country_colors <- c(
"Mexico" = "#8B5A00",           # Dark orange/brown
"Puerto Rico" = "#104E8B",      # Dark blue
"Dominican Republic" = "#004D40", # Dark teal/green
"Cuba" = "#7A2B56"              # Dark mauve/purple
)
data_adj <- data %>%
pivot_longer(
cols = all_of(adjusted_vars),
names_to = "demographic",
values_to = "mean_value"
) %>%
mutate(type = "Adjusted")
data_unadj <- data %>%
pivot_longer(
cols = all_of(unadjusted_vars),
names_to = "demographic",
values_to = "mean_value"
) %>%
mutate(type = "Unadjusted")
data_long <- bind_rows(data_adj, data_unadj) %>%
mutate(demographic = case_when(
grepl("married", demographic) ~ var_labels[4],
grepl("alone", demographic) ~ var_labels[3],
grepl("english", demographic) ~ var_labels[6],
grepl("secondary", demographic) ~ var_labels[2],
grepl("citizen|naturalized", demographic) ~ var_labels[5],
grepl("primary", demographic) ~ var_labels[1]
)) %>%
mutate(demographic = factor(demographic, levels = var_labels),
type = factor(type, levels = c("Unadjusted", "Adjusted")))
data_long[[country_var]] <- factor(
data_long[[country_var]],
levels = names(country_colors)
)
ggplot(data_long, aes(x = .data[[country_var]], y = mean_value,
fill = .data[[country_var]], alpha = type)) +
geom_bar(stat = "identity", position = "dodge", width = 0.7, color = "black") +
geom_text(aes(label = round(mean_value, 2)),
position = position_dodge(width = 0.7),
size = 4,
fontface = "bold",
color = "black",
vjust = -0.5,
alpha = 1) +
facet_wrap(~ demographic, ncol = 2) +
scale_fill_manual(values = country_colors) +
scale_alpha_manual(name = "Type",
values = c("Unadjusted" = 1, "Adjusted" = 0.25),
guide = guide_legend(override.aes = list(fill = "gray50"))) +
guides(fill = "none") +
labs(
title = title,
x = element_blank(),
y = element_blank()
) +
theme_cowplot() +
ylim(y_limits) +
theme(
strip.background = element_blank(),
strip.text = element_text(size = 12, face = "bold"),
axis.text.x = element_text(size = 11, face = "bold", angle = 45, hjust = 1),
panel.spacing = unit(0.5, "lines"),
panel.border = element_rect(color = "black", fill = NA, linewidth = 0.5),
legend.position = "bottom",
legend.justification = "center",
axis.ticks.y = element_blank(),
axis.text.y = element_blank(),
axis.line.y = element_blank(),
panel.background = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()
)
}
create_country_summary <- function(raw_data, adjusted_data) {
raw_select <- raw_data %>%
select(term, starts_with("mean_"))
adjusted_select <- adjusted_data %>%
select(term, starts_with("adjusted_mean"))
print(head(adjusted_select))
combined_df <- left_join(raw_select, adjusted_select, by = "term") %>%
rename_with(~str_remove(., "_estimate")) %>%
mutate(
across(
starts_with("adjusted_mean_"),
~if_else(term == "mexico",
get(str_replace(cur_column(), "adjusted_mean_", "mean_")),
.x)
)
) %>%
mutate(
adjusted_mean_is_naturalized_citizen = case_when(
term == "puerto rico" ~ NA,
TRUE ~ adjusted_mean_is_naturalized_citizen
),
country_string = case_when(
term == "mexico" ~ "Mexico",
term == "cuba" ~ "Cuba",
term == "dominican republic" ~ "Dominican Republic",
term == "puerto rico" ~ "Puerto Rico"
),
country_string = fct_relevel(country_string,
"Mexico", "Puerto Rico", "Dominican Republic", "Cuba")
) %>%
rename(
mean_secondary_completed = mean_secondary_or_above,
mean_is_citizen = mean_is_naturalized_citizen
)
return(combined_df)
}
# iterate over both lists simultaneously
results <- create_country_summary(country_coefs_interaction_no_cont, country_coefs_interaction)
results_male <- create_country_summary(male_country_coefs_interaction_no_cont, male_country_coefs_interaction)
results_female <- create_country_summary(female_country_coefs_interaction_no_cont, female_country_coefs_interaction)
country_change <- create_faceted_demo_plot2(results,
y_limits = c(-.1, .15)) +
geom_hline(yintercept = 0, linetype = "dashed")
country_change_male <- create_faceted_demo_plot2(results_male,
y_limits = c(-.1, .15)) +
geom_hline(yintercept = 0, linetype = "dashed")
country_change_female <- create_faceted_demo_plot2(results_female,
y_limits = c(-.1, .15)) +
geom_hline(yintercept = 0, linetype = "dashed")
plot_list <- list(
"country_levels_colors_change" = country_change,
"country_levels_male_colors_change" = country_change_male,
"country_levels_female_colors_change" = country_change_female
)
for (i in names(plot_list)) {
print(plot_list[[i]])
ggsave(
filename = file.path(plot_dir, paste0(i, ".pdf")),
plot = plot_list[[i]],
device = "pdf",
width = 9,
height = 10,
dpi = 300
)
}
create_faceted_demo_plot2 <- function(data,
adjusted_vars = c("adjusted_mean_less_than_primary_completed",
"adjusted_mean_secondary_or_above",
"adjusted_mean_lives_alone",
"adjusted_mean_married_cohab",
"adjusted_mean_is_naturalized_citizen",
"adjusted_mean_english_speaker"),
unadjusted_vars = c("mean_less_than_primary_completed",
"mean_secondary_completed",
"mean_lives_alone",
"mean_married_cohab",
"mean_is_citizen",
"mean_english_speaker"),
var_labels = c("Less than Primary",
"Secondary or Above",
"Lives Alone",
"Married/Cohabiting",
"Naturalized Citizen",
"English Speaker"),
country_var = "country_string",
title = element_blank(),
y_limits = c(0, .7)) {
country_colors <- c(
"Mexico" = "#8B5A00",           # Dark orange/brown
"Puerto Rico" = "#104E8B",      # Dark blue
"Dominican Republic" = "#004D40", # Dark teal/green
"Cuba" = "#7A2B56"              # Dark mauve/purple
)
data_adj <- data %>%
pivot_longer(
cols = all_of(adjusted_vars),
names_to = "demographic",
values_to = "mean_value"
) %>%
mutate(type = "Adjusted")
data_unadj <- data %>%
pivot_longer(
cols = all_of(unadjusted_vars),
names_to = "demographic",
values_to = "mean_value"
) %>%
mutate(type = "Unadjusted")
data_long <- bind_rows(data_adj, data_unadj) %>%
mutate(demographic = case_when(
grepl("married", demographic) ~ var_labels[4],
grepl("alone", demographic) ~ var_labels[3],
grepl("english", demographic) ~ var_labels[6],
grepl("secondary", demographic) ~ var_labels[2],
grepl("citizen|naturalized", demographic) ~ var_labels[5],
grepl("primary", demographic) ~ var_labels[1]
)) %>%
mutate(demographic = factor(demographic, levels = var_labels),
type = factor(type, levels = c("Unadjusted", "Adjusted")))
data_long[[country_var]] <- factor(
data_long[[country_var]],
levels = names(country_colors)
)
ggplot(data_long, aes(x = .data[[country_var]], y = mean_value,
fill = .data[[country_var]], alpha = type)) +
geom_bar(stat = "identity", position = "dodge", width = 0.7, color = "black") +
geom_text(aes(label = round(mean_value, 2), group = type),
position = position_dodge(width = 0.7),
size = 4,
fontface = "bold",
color = "black",
vjust = -0.5,
alpha = 1) +
facet_wrap(~ demographic, ncol = 2) +
scale_fill_manual(values = country_colors) +
scale_alpha_manual(name = "Type",
values = c("Unadjusted" = 1, "Adjusted" = 0.25),
guide = guide_legend(override.aes = list(fill = "gray50"))) +
guides(fill = "none") +
labs(
title = title,
x = element_blank(),
y = element_blank()
) +
theme_cowplot() +
ylim(y_limits) +
theme(
strip.background = element_blank(),
strip.text = element_text(size = 12, face = "bold"),
axis.text.x = element_text(size = 11, face = "bold", angle = 45, hjust = 1),
panel.spacing = unit(0.5, "lines"),
panel.border = element_rect(color = "black", fill = NA, linewidth = 0.5),
legend.position = "bottom",
legend.justification = "center",
axis.ticks.y = element_blank(),
axis.text.y = element_blank(),
axis.line.y = element_blank(),
panel.background = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()
)
}
create_country_summary <- function(raw_data, adjusted_data) {
raw_select <- raw_data %>%
select(term, starts_with("mean_"))
adjusted_select <- adjusted_data %>%
select(term, starts_with("adjusted_mean"))
print(head(adjusted_select))
combined_df <- left_join(raw_select, adjusted_select, by = "term") %>%
rename_with(~str_remove(., "_estimate")) %>%
mutate(
across(
starts_with("adjusted_mean_"),
~if_else(term == "mexico",
get(str_replace(cur_column(), "adjusted_mean_", "mean_")),
.x)
)
) %>%
mutate(
adjusted_mean_is_naturalized_citizen = case_when(
term == "puerto rico" ~ NA,
TRUE ~ adjusted_mean_is_naturalized_citizen
),
country_string = case_when(
term == "mexico" ~ "Mexico",
term == "cuba" ~ "Cuba",
term == "dominican republic" ~ "Dominican Republic",
term == "puerto rico" ~ "Puerto Rico"
),
country_string = fct_relevel(country_string,
"Mexico", "Puerto Rico", "Dominican Republic", "Cuba")
) %>%
rename(
mean_secondary_completed = mean_secondary_or_above,
mean_is_citizen = mean_is_naturalized_citizen
)
return(combined_df)
}
# iterate over both lists simultaneously
results <- create_country_summary(country_coefs_interaction_no_cont, country_coefs_interaction)
results_male <- create_country_summary(male_country_coefs_interaction_no_cont, male_country_coefs_interaction)
results_female <- create_country_summary(female_country_coefs_interaction_no_cont, female_country_coefs_interaction)
country_change <- create_faceted_demo_plot2(results,
y_limits = c(-.1, .15)) +
geom_hline(yintercept = 0, linetype = "dashed")
country_change_male <- create_faceted_demo_plot2(results_male,
y_limits = c(-.1, .15)) +
geom_hline(yintercept = 0, linetype = "dashed")
country_change_female <- create_faceted_demo_plot2(results_female,
y_limits = c(-.1, .15)) +
geom_hline(yintercept = 0, linetype = "dashed")
plot_list <- list(
"country_levels_colors_change" = country_change,
"country_levels_male_colors_change" = country_change_male,
"country_levels_female_colors_change" = country_change_female
)
for (i in names(plot_list)) {
print(plot_list[[i]])
ggsave(
filename = file.path(plot_dir, paste0(i, ".pdf")),
plot = plot_list[[i]],
device = "pdf",
width = 9,
height = 10,
dpi = 300
)
}
create_faceted_demo_plot2 <- function(data,
adjusted_vars = c("adjusted_mean_less_than_primary_completed",
"adjusted_mean_secondary_or_above",
"adjusted_mean_lives_alone",
"adjusted_mean_married_cohab",
"adjusted_mean_is_naturalized_citizen",
"adjusted_mean_english_speaker"),
unadjusted_vars = c("mean_less_than_primary_completed",
"mean_secondary_completed",
"mean_lives_alone",
"mean_married_cohab",
"mean_is_citizen",
"mean_english_speaker"),
var_labels = c("Less than Primary",
"Secondary or Above",
"Lives Alone",
"Married/Cohabiting",
"Naturalized Citizen",
"English Speaker"),
country_var = "country_string",
title = element_blank(),
y_limits = c(0, .7)) {
country_colors <- c(
"Mexico" = "#8B5A00",           # Dark orange/brown
"Puerto Rico" = "#104E8B",      # Dark blue
"Dominican Republic" = "#004D40", # Dark teal/green
"Cuba" = "#7A2B56"              # Dark mauve/purple
)
data_adj <- data %>%
pivot_longer(
cols = all_of(adjusted_vars),
names_to = "demographic",
values_to = "mean_value"
) %>%
mutate(type = "Adjusted")
data_unadj <- data %>%
pivot_longer(
cols = all_of(unadjusted_vars),
names_to = "demographic",
values_to = "mean_value"
) %>%
mutate(type = "Unadjusted")
data_long <- bind_rows(data_adj, data_unadj) %>%
mutate(demographic = case_when(
grepl("married", demographic) ~ var_labels[4],
grepl("alone", demographic) ~ var_labels[3],
grepl("english", demographic) ~ var_labels[6],
grepl("secondary", demographic) ~ var_labels[2],
grepl("citizen|naturalized", demographic) ~ var_labels[5],
grepl("primary", demographic) ~ var_labels[1]
)) %>%
mutate(demographic = factor(demographic, levels = var_labels),
type = factor(type, levels = c("Unadjusted", "Adjusted")))
data_long[[country_var]] <- factor(
data_long[[country_var]],
levels = names(country_colors)
)
ggplot(data_long, aes(x = .data[[country_var]], y = mean_value,
fill = .data[[country_var]], alpha = type)) +
geom_bar(stat = "identity", position = "dodge", width = 0.7, color = "black") +
geom_text(aes(label = round(mean_value, 2),
group = type,
vjust = ifelse(mean_value < 0, 1.5, -0.5)),
position = position_dodge(width = 0.7),
size = 4,
fontface = "bold",
color = "black",
alpha = 1) +
facet_wrap(~ demographic, ncol = 2) +
scale_fill_manual(values = country_colors) +
scale_alpha_manual(name = "Type",
values = c("Unadjusted" = 1, "Adjusted" = 0.25),
guide = guide_legend(override.aes = list(fill = "gray50"))) +
guides(fill = "none") +
labs(
title = title,
x = element_blank(),
y = element_blank()
) +
theme_cowplot() +
ylim(y_limits) +
theme(
strip.background = element_blank(),
strip.text = element_text(size = 12, face = "bold"),
axis.text.x = element_text(size = 11, face = "bold", angle = 45, hjust = 1),
panel.spacing = unit(0.5, "lines"),
panel.border = element_rect(color = "black", fill = NA, linewidth = 0.5),
legend.position = "bottom",
legend.justification = "center",
axis.ticks.y = element_blank(),
axis.text.y = element_blank(),
axis.line.y = element_blank(),
panel.background = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()
)
}
create_country_summary <- function(raw_data, adjusted_data) {
raw_select <- raw_data %>%
select(term, starts_with("mean_"))
adjusted_select <- adjusted_data %>%
select(term, starts_with("adjusted_mean"))
print(head(adjusted_select))
combined_df <- left_join(raw_select, adjusted_select, by = "term") %>%
rename_with(~str_remove(., "_estimate")) %>%
mutate(
across(
starts_with("adjusted_mean_"),
~if_else(term == "mexico",
get(str_replace(cur_column(), "adjusted_mean_", "mean_")),
.x)
)
) %>%
mutate(
adjusted_mean_is_naturalized_citizen = case_when(
term == "puerto rico" ~ NA,
TRUE ~ adjusted_mean_is_naturalized_citizen
),
country_string = case_when(
term == "mexico" ~ "Mexico",
term == "cuba" ~ "Cuba",
term == "dominican republic" ~ "Dominican Republic",
term == "puerto rico" ~ "Puerto Rico"
),
country_string = fct_relevel(country_string,
"Mexico", "Puerto Rico", "Dominican Republic", "Cuba")
) %>%
rename(
mean_secondary_completed = mean_secondary_or_above,
mean_is_citizen = mean_is_naturalized_citizen
)
return(combined_df)
}
# iterate over both lists simultaneously
results <- create_country_summary(country_coefs_interaction_no_cont, country_coefs_interaction)
results_male <- create_country_summary(male_country_coefs_interaction_no_cont, male_country_coefs_interaction)
results_female <- create_country_summary(female_country_coefs_interaction_no_cont, female_country_coefs_interaction)
country_change <- create_faceted_demo_plot2(results,
y_limits = c(-.1, .15)) +
geom_hline(yintercept = 0, linetype = "dashed")
country_change_male <- create_faceted_demo_plot2(results_male,
y_limits = c(-.1, .15)) +
geom_hline(yintercept = 0, linetype = "dashed")
country_change_female <- create_faceted_demo_plot2(results_female,
y_limits = c(-.1, .15)) +
geom_hline(yintercept = 0, linetype = "dashed")
plot_list <- list(
"country_levels_colors_change" = country_change,
"country_levels_male_colors_change" = country_change_male,
"country_levels_female_colors_change" = country_change_female
)
for (i in names(plot_list)) {
print(plot_list[[i]])
ggsave(
filename = file.path(plot_dir, paste0(i, ".pdf")),
plot = plot_list[[i]],
device = "pdf",
width = 9,
height = 10,
dpi = 300
)
}
