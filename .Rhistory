summary(primary_completed_model_me)
get_emmeans_summary <- function(model, specs = "age_at_immig_groups_string", age = 65, female = 1, english_speaker = 1, race_string = "white hispanic", year_of_immig_groups_string = "1980 - 1999") {
emm <- emmeans(model,
specs = specs,
at = list(age = age, female = female, english_speaker = english_speaker, race_string = race_string, year_of_immig_groups_string = year_of_immig_groups_string),
type = "response")
emm_summary <- transform(summary(emm))
return(emm_summary)
}
emm_primary_completed_model_me <- get_emmeans_summary(primary_completed_model_me) %>%
mutate(country = "mexico")
emm_primary_completed_model_cu <- get_emmeans_summary(primary_completed_model_cu) %>%
mutate(country = "cuba")
emm_primary_completed_model_pr <- get_emmeans_summary(primary_completed_model_pr) %>%
mutate(country = "puerto rico")
emm_primary_completed_model_dr <- get_emmeans_summary(primary_completed_model_dr) %>%
mutate(country = "dominican republic")
all_emms_full_controls <- rbind(emm_primary_completed_model_me, emm_primary_completed_model_cu, emm_primary_completed_model_pr, emm_primary_completed_model_dr)
print(all_emms_full_controls)
ggplot(all_emms_full_controls, aes(x = age_at_immig_groups_string, y = prob, color = country, group = country)) +
geom_point(position = position_dodge(width = 0.2)) +
geom_line(position = position_dodge(width = 0.2)) +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0.1, position = position_dodge(width = 0.2)) +
labs(x = "Age at Immigration", y = "Probability of Primary Education or Above",
title = "Probability of Primary Education or Above by Age at Immigration and Country") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_color_brewer(palette = "Set1")
ggsave(paste0(plot_dir, "predicted_primary_education_by_immigration_age_and_country.png"), width = 12, height = 8)
primary_completed_model_me <- run_education_model(us_df_2020, "is_naturalized_citizen", "mexico")
primary_completed_model_cu <- run_education_model(us_df_2020, "is_naturalized_citizen", "cuba")
primary_completed_model_dr <- run_education_model(us_df_2020, "is_naturalized_citizen", "dominican republic")
summary(primary_completed_model_me)
get_emmeans_summary <- function(model, specs = "age_at_immig_groups_string", age = 65, female = 1, english_speaker = 1, race_string = "white hispanic", year_of_immig_groups_string = "1980 - 1999") {
emm <- emmeans(model,
specs = specs,
at = list(age = age, female = female, english_speaker = english_speaker, race_string = race_string, year_of_immig_groups_string = year_of_immig_groups_string),
type = "response")
emm_summary <- transform(summary(emm))
return(emm_summary)
}
emm_primary_completed_model_me <- get_emmeans_summary(primary_completed_model_me) %>%
mutate(country = "mexico")
emm_primary_completed_model_cu <- get_emmeans_summary(primary_completed_model_cu) %>%
mutate(country = "cuba")
emm_primary_completed_model_dr <- get_emmeans_summary(primary_completed_model_dr) %>%
mutate(country = "dominican republic")
all_emms_full_controls <- rbind(emm_primary_completed_model_me, emm_primary_completed_model_cu, emm_primary_completed_model_dr)
print(all_emms_full_controls)
ggplot(all_emms_full_controls, aes(x = age_at_immig_groups_string, y = prob, color = country, group = country)) +
geom_point(position = position_dodge(width = 0.2)) +
geom_line(position = position_dodge(width = 0.2)) +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0.1, position = position_dodge(width = 0.2)) +
labs(x = "Age at Immigration", y = "Probability of Primary Education or Above",
title = "Probability of Naturalized Citizen by Age at Immigration and Country") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_color_brewer(palette = "Set1")
ggsave(paste0(plot_dir, "predicted_primary_education_by_immigration_age_and_country.png"), width = 12, height = 8)
run_education_model <- function(data, dv, country) {
model <- data %>%
filter(country_string == country) %>%
glm(as.formula(paste(dv, "~ age + as.factor(female) + race_string + as.factor(english_speaker) + married_cohab + year_of_immig_groups_string + age_at_immig_groups_string")),
data = .,
family = binomial(),
weights = perwt)
return(model)
}
primary_completed_model_me <- run_education_model(us_df_2020, "primary_or_above", "mexico")
primary_completed_model_cu <- run_education_model(us_df_2020, "primary_or_above", "cuba")
primary_completed_model_pr <- run_education_model(us_df_2020, "primary_or_above", "puerto rico")
primary_completed_model_dr <- run_education_model(us_df_2020, "primary_or_above", "dominican republic")
summary(primary_completed_model_me)
get_emmeans_summary <- function(model, specs = "age_at_immig_groups_string", age = 65, female = 1, english_speaker = 1, race_string = "white hispanic", year_of_immig_groups_string = "1980 - 1999") {
emm <- emmeans(model,
specs = specs,
at = list(age = age, female = female, english_speaker = english_speaker, race_string = race_string, year_of_immig_groups_string = year_of_immig_groups_string),
type = "response")
emm_summary <- transform(summary(emm))
return(emm_summary)
}
emm_primary_completed_model_me <- get_emmeans_summary(primary_completed_model_me) %>%
mutate(country = "mexico")
emm_primary_completed_model_cu <- get_emmeans_summary(primary_completed_model_cu) %>%
mutate(country = "cuba")
emm_primary_completed_model_pr <- get_emmeans_summary(primary_completed_model_pr) %>%
mutate(country = "puerto rico")
emm_primary_completed_model_dr <- get_emmeans_summary(primary_completed_model_dr) %>%
mutate(country = "dominican republic")
all_emms_full_controls <- rbind(emm_primary_completed_model_me, emm_primary_completed_model_cu, emm_primary_completed_model_pr, emm_primary_completed_model_dr)
print(all_emms_full_controls)
ggplot(all_emms_full_controls, aes(x = age_at_immig_groups_string, y = prob, color = country, group = country)) +
geom_point(position = position_dodge(width = 0.2)) +
geom_line(position = position_dodge(width = 0.2)) +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0.1, position = position_dodge(width = 0.2)) +
labs(x = "Age at Immigration", y = "Probability of Primary Education or Above",
title = "Probability of Primary Education or Above by Age at Immigration and Country") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_color_brewer(palette = "Set1")
ggsave(paste0(plot_dir, "predicted_primary_education_by_immigration_age_and_country.png"), width = 12, height = 8)
primary_completed_model_me <- run_education_model(us_df_2020, "is_naturalized_citizen", "mexico")
primary_completed_model_cu <- run_education_model(us_df_2020, "is_naturalized_citizen", "cuba")
primary_completed_model_dr <- run_education_model(us_df_2020, "is_naturalized_citizen", "dominican republic")
summary(primary_completed_model_me)
get_emmeans_summary <- function(model, specs = "age_at_immig_groups_string", age = 65, female = 1, english_speaker = 1, race_string = "white hispanic", year_of_immig_groups_string = "1980 - 1999") {
emm <- emmeans(model,
specs = specs,
at = list(age = age, female = female, english_speaker = english_speaker, race_string = race_string, year_of_immig_groups_string = year_of_immig_groups_string),
type = "response")
emm_summary <- transform(summary(emm))
return(emm_summary)
}
emm_primary_completed_model_me <- get_emmeans_summary(primary_completed_model_me) %>%
mutate(country = "mexico")
emm_primary_completed_model_cu <- get_emmeans_summary(primary_completed_model_cu) %>%
mutate(country = "cuba")
emm_primary_completed_model_dr <- get_emmeans_summary(primary_completed_model_dr) %>%
mutate(country = "dominican republic")
all_emms_full_controls <- rbind(emm_primary_completed_model_me, emm_primary_completed_model_cu, emm_primary_completed_model_dr)
print(all_emms_full_controls)
ggplot(all_emms_full_controls, aes(x = age_at_immig_groups_string, y = prob, color = country, group = country)) +
geom_point(position = position_dodge(width = 0.2)) +
geom_line(position = position_dodge(width = 0.2)) +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0.1, position = position_dodge(width = 0.2)) +
labs(x = "Age at Immigration", y = "Probability of Primary Education or Above",
title = "Probability of Naturalized Citizen by Age at Immigration and Country") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_color_brewer(palette = "Set1")
ggsave(paste0(plot_dir, "predicted_citizen_by_immigration_age_and_country.png"), width = 12, height = 8)
primary_completed_model_me <- run_education_model(us_df_2020, "english_speaker", "mexico")
primary_completed_model_cu <- run_education_model(us_df_2020, "english_speaker", "cuba")
primary_completed_model_pr <- run_education_model(us_df_2020, "english_speaker", "puerto rico")
primary_completed_model_dr <- run_education_model(us_df_2020, "english_speaker", "dominican republic")
summary(primary_completed_model_me)
get_emmeans_summary <- function(model, specs = "age_at_immig_groups_string", age = 65, female = 1, english_speaker = 1, race_string = "white hispanic", year_of_immig_groups_string = "1980 - 1999") {
emm <- emmeans(model,
specs = specs,
at = list(age = age, female = female, english_speaker = english_speaker, race_string = race_string, year_of_immig_groups_string = year_of_immig_groups_string),
type = "response")
emm_summary <- transform(summary(emm))
return(emm_summary)
}
emm_primary_completed_model_me <- get_emmeans_summary(primary_completed_model_me) %>%
mutate(country = "mexico")
emm_primary_completed_model_cu <- get_emmeans_summary(primary_completed_model_cu) %>%
mutate(country = "cuba")
emm_primary_completed_model_pr <- get_emmeans_summary(primary_completed_model_pr) %>%
mutate(country = "puerto rico")
emm_primary_completed_model_dr <- get_emmeans_summary(primary_completed_model_dr) %>%
mutate(country = "dominican republic")
all_emms_full_controls <- rbind(emm_primary_completed_model_me, emm_primary_completed_model_cu, emm_primary_completed_model_pr, emm_primary_completed_model_dr)
print(all_emms_full_controls)
ggplot(all_emms_full_controls, aes(x = age_at_immig_groups_string, y = prob, color = country, group = country)) +
geom_point(position = position_dodge(width = 0.2)) +
geom_line(position = position_dodge(width = 0.2)) +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0.1, position = position_dodge(width = 0.2)) +
labs(x = "Age at Immigration", y = "Probability of Primary Education or Above",
title = "Probability of Primary Education or Above by Age at Immigration and Country") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_color_brewer(palette = "Set1")
ggsave(paste0(plot_dir, "predicted_english_speaking_by_immigration_age_and_country.png"), width = 12, height = 8)
primary_completed_model_me <- run_education_model(us_df_2020, "is_naturalized_citizen", "mexico")
primary_completed_model_cu <- run_education_model(us_df_2020, "is_naturalized_citizen", "cuba")
primary_completed_model_dr <- run_education_model(us_df_2020, "is_naturalized_citizen", "dominican republic")
summary(primary_completed_model_me)
get_emmeans_summary <- function(model, specs = "age_at_immig_groups_string", age = 65, female = 1, english_speaker = 1, race_string = "white hispanic", year_of_immig_groups_string = "1980 - 1999") {
emm <- emmeans(model,
specs = specs,
at = list(age = age, female = female, english_speaker = english_speaker, race_string = race_string, year_of_immig_groups_string = year_of_immig_groups_string),
type = "response")
emm_summary <- transform(summary(emm))
return(emm_summary)
}
emm_primary_completed_model_me <- get_emmeans_summary(primary_completed_model_me) %>%
mutate(country = "mexico")
emm_primary_completed_model_cu <- get_emmeans_summary(primary_completed_model_cu) %>%
mutate(country = "cuba")
emm_primary_completed_model_dr <- get_emmeans_summary(primary_completed_model_dr) %>%
mutate(country = "dominican republic")
all_emms_full_controls <- rbind(emm_primary_completed_model_me, emm_primary_completed_model_cu, emm_primary_completed_model_dr)
print(all_emms_full_controls)
ggplot(all_emms_full_controls, aes(x = age_at_immig_groups_string, y = prob, color = country, group = country)) +
geom_point(position = position_dodge(width = 0.2)) +
geom_line(position = position_dodge(width = 0.2)) +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0.1, position = position_dodge(width = 0.2)) +
labs(x = "Age at Immigration", y = "Probability",
title = "Probability of Naturalized Citizen by Age at Immigration and Country") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_color_brewer(palette = "Set1")
ggsave(paste0(plot_dir, "predicted_citizen_by_immigration_age_and_country.png"), width = 12, height = 8)
table(us_df_2020$english_speaker)
primary_completed_model_me <- run_education_model(us_df_2020, "english_speaker", "mexico")
summary(primary_completed_model_me)
run_education_model <- function(data, dv, country) {
model <- data %>%
filter(country_string == country) %>%
glm(as.formula(paste(dv, "~ age + as.factor(female) + race_string + as.factor(is_naturalized_citizen) + married_cohab + year_of_immig_groups_string + age_at_immig_groups_string")),
data = .,
family = binomial(),
weights = perwt)
return(model)
}
primary_completed_model_me <- run_education_model(us_df_2020, "english_speaker", "mexico")
primary_completed_model_cu <- run_education_model(us_df_2020, "english_speaker", "cuba")
primary_completed_model_pr <- run_education_model(us_df_2020, "english_speaker", "puerto rico")
run_education_model <- function(data, dv, country) {
model <- data %>%
filter(country_string == country) %>%
glm(as.formula(paste(dv, "~ age + as.factor(female) + race_string + as.factor(is_naturalized_citizen) + married_cohab + year_of_immig_groups_string + age_at_immig_groups_string")),
data = .,
family = binomial(),
weights = perwt)
return(model)
}
primary_completed_model_me <- run_education_model(us_df_2020, "english_speaker", "mexico")
primary_completed_model_cu <- run_education_model(us_df_2020, "english_speaker", "cuba")
primary_completed_model_dr <- run_education_model(us_df_2020, "english_speaker", "dominican republic")
run_education_model <- function(data, dv, country) {
model <- data %>%
filter(country_string == country) %>%
glm(as.formula(paste(dv, "~ age + as.factor(female) + race_string + married_cohab + year_of_immig_groups_string + age_at_immig_groups_string")),
data = .,
family = binomial(),
weights = perwt)
return(model)
}
primary_completed_model_pr <- run_education_model(us_df_2020, "english_speaker", "puerto rico")
summary(primary_completed_model_me)
get_emmeans_summary <- function(model, specs = "age_at_immig_groups_string", age = 65, female = 1, english_speaker = 1, race_string = "white hispanic", year_of_immig_groups_string = "1980 - 1999") {
emm <- emmeans(model,
specs = specs,
at = list(age = age, female = female, english_speaker = english_speaker, race_string = race_string, year_of_immig_groups_string = year_of_immig_groups_string),
type = "response")
emm_summary <- transform(summary(emm))
return(emm_summary)
}
emm_primary_completed_model_me <- get_emmeans_summary(primary_completed_model_me) %>%
mutate(country = "mexico")
emm_primary_completed_model_cu <- get_emmeans_summary(primary_completed_model_cu) %>%
mutate(country = "cuba")
emm_primary_completed_model_pr <- get_emmeans_summary(primary_completed_model_pr) %>%
mutate(country = "puerto rico")
emm_primary_completed_model_dr <- get_emmeans_summary(primary_completed_model_dr) %>%
mutate(country = "dominican republic")
all_emms_full_controls <- rbind(emm_primary_completed_model_me, emm_primary_completed_model_cu, emm_primary_completed_model_pr, emm_primary_completed_model_dr)
print(all_emms_full_controls)
ggplot(all_emms_full_controls, aes(x = age_at_immig_groups_string, y = prob, color = country, group = country)) +
geom_point(position = position_dodge(width = 0.2)) +
geom_line(position = position_dodge(width = 0.2)) +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0.1, position = position_dodge(width = 0.2)) +
labs(x = "Age at Immigration", y = "Probability",
title = "Probability of Speaking English by Age at Immigration and Country") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_color_brewer(palette = "Set1")
ggsave(paste0(plot_dir, "predicted_english_speaking_by_immigration_age_and_country.png"), width = 12, height = 8)
run_education_model <- function(data, dv, country) {
model <- data %>%
filter(country_string == country) %>%
glm(as.formula(paste(dv, "~ age + as.factor(female) + race_string + as.factor(is_naturalized_citizen) + married_cohab + year_of_immig_groups_string + age_at_immig_groups_string")),
data = .,
family = binomial(),
weights = perwt)
return(model)
}
primary_completed_model_me <- run_education_model(us_df_2020, "english_speaker", "mexico")
primary_completed_model_cu <- run_education_model(us_df_2020, "english_speaker", "cuba")
primary_completed_model_dr <- run_education_model(us_df_2020, "english_speaker", "dominican republic")
run_education_model <- function(data, dv, country) {
model <- data %>%
filter(country_string == country) %>%
glm(as.formula(paste(dv, "~ age + as.factor(female) + race_string + married_cohab + year_of_immig_groups_string + age_at_immig_groups_string")),
data = .,
family = binomial(),
weights = perwt)
return(model)
}
primary_completed_model_pr <- run_education_model(us_df_2020, "english_speaker", "puerto rico")
summary(primary_completed_model_me)
get_emmeans_summary <- function(model, specs = "age_at_immig_groups_string", age = 65, female = 1, race_string = "white hispanic", year_of_immig_groups_string = "1980 - 1999") {
emm <- emmeans(model,
specs = specs,
at = list(age = age, female = female, race_string = race_string, year_of_immig_groups_string = year_of_immig_groups_string),
type = "response")
emm_summary <- transform(summary(emm))
return(emm_summary)
}
emm_primary_completed_model_me <- get_emmeans_summary(primary_completed_model_me) %>%
mutate(country = "mexico")
emm_primary_completed_model_cu <- get_emmeans_summary(primary_completed_model_cu) %>%
mutate(country = "cuba")
emm_primary_completed_model_pr <- get_emmeans_summary(primary_completed_model_pr) %>%
mutate(country = "puerto rico")
emm_primary_completed_model_dr <- get_emmeans_summary(primary_completed_model_dr) %>%
mutate(country = "dominican republic")
all_emms_full_controls <- rbind(emm_primary_completed_model_me, emm_primary_completed_model_cu, emm_primary_completed_model_pr, emm_primary_completed_model_dr)
print(all_emms_full_controls)
ggplot(all_emms_full_controls, aes(x = age_at_immig_groups_string, y = prob, color = country, group = country)) +
geom_point(position = position_dodge(width = 0.2)) +
geom_line(position = position_dodge(width = 0.2)) +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0.1, position = position_dodge(width = 0.2)) +
labs(x = "Age at Immigration", y = "Probability",
title = "Probability of Speaking English by Age at Immigration and Country") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_color_brewer(palette = "Set1")
ggsave(paste0(plot_dir, "predicted_english_speaking_by_immigration_age_and_country.png"), width = 12, height = 8)
us_df_2020$yrimmig
in_df <- in_df %>%
mutate(birth_year = year - age)
us_df_2010 <- us_df_2010 %>%
mutate(birth_year = year - age)
us_df_2020 <- us_df_2020 %>%
mutate(birth_year = year - age)
create_table_for_sex <- function(df, sex_value) {
df %>%
filter(sex == sex_value) %>%
filter(birth_year >= 1930 & birth_year <= 1950) %>%
filter(yrimmig < 2011) %>%
filter(!is.na(country_string)) %>%
group_by(country_year) %>%
summarise(
mean_less_than_primary_completed = weighted.mean(less_than_primary_completed, perwt, na.rm = TRUE),
mean_primary_completed = weighted.mean(primary_completed, perwt, na.rm = TRUE),
mean_secondary_completed = weighted.mean(secondary_completed, perwt, na.rm = TRUE),
mean_university_completed = weighted.mean(university_completed, perwt, na.rm = TRUE),
N = n()
) %>%
pivot_longer(cols = -country_year, names_to = "variable", values_to = "value") %>%
pivot_wider(names_from = country_year, values_from = value) %>%
mutate(variable = recode(variable,
mean_less_than_primary_completed = "Less than Primary",
mean_primary_completed = "Primary",
mean_secondary_completed = "Secondary",
mean_university_completed = "University"
))
}
table_prop_education_mexico_sex1 <- create_table_for_sex(in_df, 1) %>%
select(variable, Mexico_2010, Mexico_2020)
in_df <- in_df %>%
mutate(birth_year = year - age)
us_df_2010 <- us_df_2010 %>%
mutate(birth_year = year - age)
us_df_2020_immig_filtered <- us_df_2020 %>%
mutate(birth_year = year - age) %>%
filter(yrimmig < 2011)
create_table_for_sex <- function(df, sex_value) {
df %>%
filter(sex == sex_value) %>%
filter(birth_year >= 1930 & birth_year <= 1950) %>%
filter(!is.na(country_string)) %>%
group_by(country_year) %>%
summarise(
mean_less_than_primary_completed = weighted.mean(less_than_primary_completed, perwt, na.rm = TRUE),
mean_primary_completed = weighted.mean(primary_completed, perwt, na.rm = TRUE),
mean_secondary_completed = weighted.mean(secondary_completed, perwt, na.rm = TRUE),
mean_university_completed = weighted.mean(university_completed, perwt, na.rm = TRUE),
N = n()
) %>%
pivot_longer(cols = -country_year, names_to = "variable", values_to = "value") %>%
pivot_wider(names_from = country_year, values_from = value) %>%
mutate(variable = recode(variable,
mean_less_than_primary_completed = "Less than Primary",
mean_primary_completed = "Primary",
mean_secondary_completed = "Secondary",
mean_university_completed = "University"
))
}
table_prop_education_mexico_sex1 <- create_table_for_sex(in_df, 1) %>%
select(variable, Mexico_2010, Mexico_2020)
table_prop_education_mexico_sex2 <- create_table_for_sex(in_df, 2) %>%
select(variable, Mexico_2010, Mexico_2020)
table_prop_education_mexico_us_2010_sex1 <- create_table_for_sex(us_df_2010, 1) %>%
select( mexico_2010)
table_prop_education_mexico_us_2010_sex2 <- create_table_for_sex(us_df_2010, 2) %>%
select(mexico_2010)
table_prop_education_mexico_us_2020_sex1 <- create_table_for_sex(us_df_2020_immig_filtered, 1) %>%
select(mexico_2020)
table_prop_education_mexico_us_2020_sex2 <- create_table_for_sex(us_df_2020_immig_filtered, 2) %>%
select(mexico_2020)
table_prop_education_mexico1 <- bind_rows(
table_prop_education_mexico_sex2,
table_prop_education_mexico_sex1
)
table_prop_education_mexico2 <- bind_rows(
table_prop_education_mexico_us_2010_sex2,
table_prop_education_mexico_us_2010_sex1
)
table_prop_education_mexico3 <- bind_rows(
table_prop_education_mexico_us_2020_sex2,
table_prop_education_mexico_us_2020_sex1
)
table_prop_education_mexico <- cbind(table_prop_education_mexico1, table_prop_education_mexico2, table_prop_education_mexico3)
rm(table_prop_education_mexico3, table_prop_education_mexico2, table_prop_education_mexico1, table_prop_education_mexico_us_2020_sex2, table_prop_education_mexico_us_2020_sex1, table_prop_education_mexico_us_2010_sex2,
table_prop_education_mexico_us_2010_sex1, table_prop_education_mexico_sex2, table_prop_education_mexico_sex1)
table_prop_education_mexico <- table_prop_education_mexico %>%
rename(`Mexico 2010` = Mexico_2010,
`Mexico 2020` = Mexico_2020,
`Mexico-Born US 2010` = mexico_2010,
`Mexico-Born US 2020` = mexico_2020
) %>%
rename(Demographics = variable) %>%
add_row(Demographics = "Education Completed", .before = 1) %>%
add_row(Demographics = "Education Completed", .before = 8) %>%
mutate(Gender = ifelse(row_number() == 1, "Female",
ifelse(row_number() == 7, "Male", ""))) %>%
select(Gender, everything())
print(table_prop_education_mexico)
table_prop_education_mexico_code <- xtable(table_prop_education_mexico,
caption = "Educational Attainment of Mexican-Born Individuals by Gender and Location (2010-2020)",
align = "lll|cccc")
latex_code <- capture.output(print(table_prop_education_mexico_code,
type = "latex",
caption.placement = "top",
size = "\\small",
include.rownames = FALSE))
tabular_line_index <- grep("\\\\begin\\{tabular\\}", latex_code)
latex_code[tabular_line_index] <- "\\begin{tabular}{l>{\\raggedright\\arraybackslash}p{3.2cm}|cccc}"
latex_code <- adjust_latex_rows(latex_code, adjustments)
print(latex_code)
writeLines(latex_code, "/Users/chrissoria/Documents/Research/us_international_ses/tables/r_tables/table_prop_education_mexico_code.tex")
rm(latex_code, table_prop_education_mexico_code, table_prop_education_mexico)
in_df <- in_df %>%
mutate(birth_year = year - age)
us_df_2010 <- us_df_2010 %>%
mutate(birth_year = year - age)
us_df_2020_immig_filtered <- us_df_2020 %>%
mutate(birth_year = year - age) %>%
filter(yrimmig < 2011)
create_table_for_sex <- function(df, sex_value) {
df %>%
filter(sex == sex_value) %>%
filter(birth_year >= 1930 & birth_year <= 1950) %>%
filter(!is.na(country_string)) %>%
group_by(country_year) %>%
summarise(
mean_less_than_primary_completed = weighted.mean(less_than_primary_completed, perwt, na.rm = TRUE),
mean_primary_completed = weighted.mean(primary_completed, perwt, na.rm = TRUE),
mean_secondary_completed = weighted.mean(secondary_completed, perwt, na.rm = TRUE),
mean_university_completed = weighted.mean(university_completed, perwt, na.rm = TRUE),
N = n()
) %>%
pivot_longer(cols = -country_year, names_to = "variable", values_to = "value") %>%
pivot_wider(names_from = country_year, values_from = value) %>%
mutate(variable = recode(variable,
mean_less_than_primary_completed = "Less than Primary",
mean_primary_completed = "Primary",
mean_secondary_completed = "Secondary",
mean_university_completed = "University"
))
}
table_prop_education_mexico_sex1 <- create_table_for_sex(in_df, 1) %>%
select(variable, Mexico_2010, Mexico_2020)
table_prop_education_mexico_sex2 <- create_table_for_sex(in_df, 2) %>%
select(variable, Mexico_2010, Mexico_2020)
table_prop_education_mexico_us_2010_sex1 <- create_table_for_sex(us_df_2010, 1) %>%
select( mexico_2010)
table_prop_education_mexico_us_2010_sex2 <- create_table_for_sex(us_df_2010, 2) %>%
select(mexico_2010)
table_prop_education_mexico_us_2020_sex1 <- create_table_for_sex(us_df_2020_immig_filtered, 1) %>%
select(mexico_2020)
table_prop_education_mexico_us_2020_sex2 <- create_table_for_sex(us_df_2020_immig_filtered, 2) %>%
select(mexico_2020)
table_prop_education_mexico1 <- bind_rows(
table_prop_education_mexico_sex2,
table_prop_education_mexico_sex1
)
table_prop_education_mexico2 <- bind_rows(
table_prop_education_mexico_us_2010_sex2,
table_prop_education_mexico_us_2010_sex1
)
table_prop_education_mexico3 <- bind_rows(
table_prop_education_mexico_us_2020_sex2,
table_prop_education_mexico_us_2020_sex1
)
table_prop_education_mexico <- cbind(table_prop_education_mexico1, table_prop_education_mexico2, table_prop_education_mexico3)
rm(table_prop_education_mexico3, table_prop_education_mexico2, table_prop_education_mexico1, table_prop_education_mexico_us_2020_sex2, table_prop_education_mexico_us_2020_sex1, table_prop_education_mexico_us_2010_sex2,
table_prop_education_mexico_us_2010_sex1, table_prop_education_mexico_sex2, table_prop_education_mexico_sex1)
table_prop_education_mexico <- table_prop_education_mexico %>%
rename(`Mexico 2010` = Mexico_2010,
`Mexico 2020` = Mexico_2020,
`Mexico-Born US 2010` = mexico_2010,
`Mexico-Born US 2020` = mexico_2020
) %>%
rename(Demographics = variable) %>%
add_row(Demographics = "Education Completed", .before = 1) %>%
add_row(Demographics = "Education Completed", .before = 7) %>%
mutate(Gender = ifelse(row_number() == 1, "Female",
ifelse(row_number() == 7, "Male", ""))) %>%
select(Gender, everything())
print(table_prop_education_mexico)
table_prop_education_mexico_code <- xtable(table_prop_education_mexico,
caption = "Educational Attainment of Mexican-Born Individuals by Gender and Location (2010-2020)",
align = "lll|cccc")
latex_code <- capture.output(print(table_prop_education_mexico_code,
type = "latex",
caption.placement = "top",
size = "\\small",
include.rownames = FALSE))
tabular_line_index <- grep("\\\\begin\\{tabular\\}", latex_code)
latex_code[tabular_line_index] <- "\\begin{tabular}{l>{\\raggedright\\arraybackslash}p{3.2cm}|cccc}"
latex_code <- adjust_latex_rows(latex_code, adjustments)
print(latex_code)
writeLines(latex_code, "/Users/chrissoria/Documents/Research/us_international_ses/tables/r_tables/table_prop_education_mexico_code.tex")
rm(latex_code, table_prop_education_mexico_code, table_prop_education_mexico)
us_df_2020$marst
in_df$marstd
us_df_2020$marst
