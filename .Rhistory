theme(plot.title = element_text(hjust = 0.5))
}
# Create a list of plots
country_plots <- prop_migration_cohort_speaks_english_long %>%
split(.$country) %>%
map(create_country_plot)
# Print each plot
walk(country_plots, print)
combined_plot <- wrap_plots(country_plots, ncol = 2)
print(combined_plot)
countries <- c("mexico", "puerto rico", "dominican republic", "cuba")
prop_migration_cohort_speaks_english_long <- prop_migration_cohort_speaks_english %>%
pivot_longer(cols = -year_of_immigration_groups,
names_to = "country",
values_to = "proportion")
create_country_plot <- function(country_data) {
ggplot(country_data, aes(x = proportion, y = year_of_immigration_groups)) +
geom_bar(stat = "identity", fill = "skyblue") +
geom_text(aes(label = scales::percent(proportion, accuracy = 0.1)),
hjust = -0.1, size = 3) +
scale_x_continuous(labels = scales::percent, limits = c(0, 1)) +
labs(title = paste("English Speakers -", unique(country_data$country)),
x = element_blank(),
y = element_blank()) +
theme_cowplot() +
theme(plot.title = element_text(hjust = 0.5))
}
country_plots <- prop_migration_cohort_speaks_english_long %>%
split(.$country) %>%
map(create_country_plot)
combined_plot <- wrap_plots(country_plots, ncol = 2)
print(combined_plot)
countries <- c("mexico", "puerto rico", "dominican republic", "cuba")
prop_migration_cohort_speaks_english_long <- prop_migration_cohort_speaks_english %>%
pivot_longer(cols = -year_of_immigration_groups,
names_to = "country",
values_to = "proportion")
create_country_plot <- function(country_data) {
ggplot(country_data, aes(x = proportion, y = year_of_immigration_groups)) +
geom_bar(stat = "identity", fill = "skyblue") +
geom_text(aes(label = scales::percent(proportion, accuracy = 0.1)),
hjust = -0.1, size = 3) +
scale_x_continuous(labels = scales::percent, limits = c(0, 1)) +
labs(title = unique(country_data$country),
x = element_blank(),
y = element_blank()) +
theme_cowplot() +
theme(plot.title = element_text(hjust = 0.5))
}
country_plots <- prop_migration_cohort_speaks_english_long %>%
split(.$country) %>%
map(create_country_plot)
combined_plot <- wrap_plots(country_plots, ncol = 2)
print(combined_plot)
countries <- c("mexico", "puerto rico", "dominican republic", "cuba")
prop_migration_cohort_speaks_english_long <- prop_migration_cohort_speaks_english %>%
pivot_longer(cols = -year_of_immigration_groups,
names_to = "country",
values_to = "proportion")
create_country_plot <- function(country_data) {
ggplot(country_data, aes(x = proportion, y = year_of_immigration_groups)) +
geom_bar(stat = "identity", fill = "skyblue") +
geom_text(aes(label = scales::percent(proportion, accuracy = 0.1)),
hjust = -0.1, size = 3) +
scale_x_continuous(labels = scales::percent, limits = c(0, 1)) +
scale_fill_manual(name = "Highest Education Achieved",
values = c("Before 1965" = "lightgreen",
"1965 - 1979" = "red",
"1980-1999" = "orange",
"After 1999" = "skyblue")) +
labs(title = unique(country_data$country),
x = element_blank(),
y = element_blank()) +
theme_cowplot() +
theme(plot.title = element_text(hjust = 0.5))
}
country_plots <- prop_migration_cohort_speaks_english_long %>%
split(.$country) %>%
map(create_country_plot)
combined_plot <- wrap_plots(country_plots, ncol = 2)
print(combined_plot)
countries <- c("mexico", "puerto rico", "dominican republic", "cuba")
prop_migration_cohort_speaks_english_long <- prop_migration_cohort_speaks_english %>%
pivot_longer(cols = -year_of_immigration_groups,
names_to = "country",
values_to = "proportion")
create_country_plot <- function(country_data) {
ggplot(country_data, aes(x = proportion, y = year_of_immigration_groups, fill = year_of_immigration_groups)) +
geom_bar(stat = "identity") +
geom_text(aes(label = scales::percent(proportion, accuracy = 0.1)),
hjust = -0.1, size = 3) +
scale_x_continuous(labels = scales::percent, limits = c(0, 1)) +
scale_fill_manual(name = "Cohort",
values = c("Before 1965" = "lightgreen",
"1965 - 1979" = "red",
"1980-1999" = "orange",
"After 1999" = "skyblue")) +
labs(title = str_to_title(unique(country_data$country)),
x = element_blank(),
y = element_blank()) +
theme_cowplot() +
theme(plot.title = element_text(hjust = 0.5),
legend.position = "none")  # Remove legend if not needed
}
country_plots <- prop_migration_cohort_speaks_english_long %>%
split(.$country) %>%
map(create_country_plot)
combined_plot <- wrap_plots(country_plots, ncol = 2)
print(combined_plot)
countries <- c("mexico", "puerto rico", "dominican republic", "cuba")
prop_migration_cohort_speaks_english_long <- prop_migration_cohort_speaks_english %>%
pivot_longer(cols = -year_of_immigration_groups,
names_to = "country",
values_to = "proportion")
create_country_plot <- function(country_data) {
ggplot(country_data, aes(x = proportion, y = year_of_immigration_groups, fill = year_of_immigration_groups)) +
geom_bar(stat = "identity") +
geom_text(aes(label = scales::percent(proportion, accuracy = 0.1)),
hjust = -0.1, size = 3) +
scale_x_continuous(labels = scales::percent, limits = c(0, 1)) +
scale_fill_manual(name = "Cohort",
values = c("Before 1965" = "lightgreen",
"1965 - 1979" = "red",
"1980-1999" = "orange",
"After 1999" = "skyblue")) +
labs(title = str_to_title(unique(country_data$country)),
x = element_blank(),
y = element_blank()) +
theme_cowplot() +
theme(plot.title = element_text(hjust = 0.5),
legend.position = "none")  # Remove legend if not needed
}
country_plots <- prop_migration_cohort_speaks_english_long %>%
split(.$country) %>%
map(create_country_plot)
combined_plot <- wrap_plots(country_plots, ncol = 2) +
plot_annotation(
title = "Proportion of English Speakers by Immigration Cohort and Country of Origin",
subtitle = "Based on us_df_2020 dataset",
theme = theme(plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5))
) &
theme(legend.position = "bottom")
combined_plot <- combined_plot +
plot_layout(guides = "collect") &
theme(legend.position = "bottom")
print(combined_plot)
ggsave(filename = paste0(out_dir,"migration_cohort_english_speaker_panels.jpg"), plot = combined_plot_migration_cohort, width = 12, height = 9, dpi = 300)
combined_plot_migration_cohort <- combined_plot +
plot_layout(guides = "collect") &
theme(legend.position = "bottom")
print(combined_plot_migration_cohort)
ggsave(filename = paste0(out_dir,"migration_cohort_english_speaker_panels.jpg"), plot = combined_plot_migration_cohort, width = 12, height = 9, dpi = 300)
countries <- c("mexico", "puerto rico", "dominican republic", "cuba")
prop_migration_cohort_speaks_english_long <- prop_migration_cohort_speaks_english %>%
pivot_longer(cols = -year_of_immigration_groups,
names_to = "country",
values_to = "proportion")
create_country_plot <- function(country_data) {
ggplot(country_data, aes(x = proportion, y = year_of_immigration_groups, fill = year_of_immigration_groups)) +
geom_bar(stat = "identity") +
geom_text(aes(label = scales::percent(proportion, accuracy = 0.1)),
hjust = -0.1, size = 3) +
scale_x_continuous(labels = scales::percent, limits = c(0, 1)) +
scale_fill_manual(name = "Cohort",
values = c("Before 1965" = "lightgreen",
"1965 - 1979" = "red",
"1980-1999" = "orange",
"After 1999" = "skyblue")) +
labs(title = str_to_title(unique(country_data$country)),
x = element_blank(),
y = element_blank()) +
theme_cowplot() +
theme(plot.title = element_text(hjust = 0.5),
legend.position = "none")  # Remove legend if not needed
}
country_plots <- prop_migration_cohort_speaks_english_long %>%
split(.$country) %>%
map(create_country_plot)
combined_plot <- wrap_plots(country_plots, ncol = 2) +
plot_annotation(
title = "Proportion of English Speakers by Immigration Cohort and Country of Origin",
subtitle = "Based on 2020 dataset",
theme = theme(plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5))
) &
theme(legend.position = "bottom")
combined_plot_migration_cohort <- combined_plot +
plot_layout(guides = "collect") &
theme(legend.position = "bottom")
print(combined_plot_migration_cohort)
ggsave(filename = paste0(out_dir,"migration_cohort_english_speaker_panels.jpg"), plot = combined_plot_migration_cohort, width = 12, height = 9, dpi = 300)
result_list <- list()
for (country in countries) {
prop_cohort_speaks_english_country <- us_df_2020 %>%
filter(country_string == country) %>%
group_by(year_of_immigration_groups) %>%
summarise(
mean_english_speaker = weighted.mean(english_speaker, perwt, na.rm = TRUE)
)
result_list[[country]] <- prop_cohort_speaks_english_country$mean_english_speaker
}
prop_migration_cohort_speaks_english <- data.frame(
year_of_immigration_groups = prop_cohort_speaks_english_country$year_of_immigration_groups,
do.call(cbind, result_list)
) %>%
mutate(year_of_immigration_groups = case_when(
year_of_immigration_groups == 1 ~ "Before 1965",
year_of_immigration_groups == 2 ~ "1965 - 1979",
year_of_immigration_groups == 3 ~ "1980 - 1999",
year_of_immigration_groups == 4 ~ "After 1999",
)) %>%
mutate(year_of_immigration_groups = factor(year_of_immigration_groups,
levels = c("Before 1965", "1965 - 1979", "1980-1999", "After 1999")))
print(prop_migration_cohort_speaks_english)
countries <- c("mexico", "puerto rico", "dominican republic", "cuba")
prop_migration_cohort_speaks_english_long <- prop_migration_cohort_speaks_english %>%
pivot_longer(cols = -year_of_immigration_groups,
names_to = "country",
values_to = "proportion")
create_country_plot <- function(country_data) {
ggplot(country_data, aes(x = proportion, y = year_of_immigration_groups, fill = year_of_immigration_groups)) +
geom_bar(stat = "identity") +
geom_text(aes(label = scales::percent(proportion, accuracy = 0.1)),
hjust = -0.1, size = 3) +
scale_x_continuous(labels = scales::percent, limits = c(0, 1)) +
scale_fill_manual(name = "Cohort",
values = c("Before 1965" = "lightgreen",
"1965 - 1979" = "red",
"1980-1999" = "orange",
"After 1999" = "skyblue")) +
labs(title = str_to_title(unique(country_data$country)),
x = element_blank(),
y = element_blank()) +
theme_cowplot() +
theme(plot.title = element_text(hjust = 0.5),
legend.position = "none")  # Remove legend if not needed
}
country_plots <- prop_migration_cohort_speaks_english_long %>%
split(.$country) %>%
map(create_country_plot)
combined_plot <- wrap_plots(country_plots, ncol = 2) +
plot_annotation(
title = "Proportion of English Speakers by Immigration Cohort and Country of Origin",
subtitle = "Based on 2020 dataset",
theme = theme(plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5))
) &
theme(legend.position = "bottom")
combined_plot_migration_cohort <- combined_plot +
plot_layout(guides = "collect") &
theme(legend.position = "bottom")
print(combined_plot_migration_cohort)
ggsave(filename = paste0(out_dir,"migration_cohort_english_speaker_panels.jpg"), plot = combined_plot_migration_cohort, width = 12, height = 9, dpi = 300)
target_dir <- normalizePath("/Users/chrissoria/Documents/Research/us_international_ses/plots")
current_dir <- normalizePath(getwd())
if (current_dir == target_dir) {
out_dir <- file.path("/Users/chrissoria/Documents/Research/us_international_ses/plots/")
data_dir <- file.path("/Users/chrissoria/Documents/Research/us_international_ses/data/")
plot_dir <- file.path("/Users/chrissoria/Documents/Research/us_international_ses//plots/")
} else {
out_dir <- file.path("C:/Users/Ty/Desktop/ses_international/plots//")
data_dir <- file.path("C:/Users/Ty/Desktop/ses_international/data//")
plot_dir <- file.path("C:/Users/Ty/Desktop/ses_international/plots//")
}
print(getwd())
countries <- c("mexico", "puerto rico", "dominican republic", "cuba")
prop_migration_cohort_speaks_english_long <- prop_migration_cohort_speaks_english %>%
pivot_longer(cols = -year_of_immigration_groups,
names_to = "country",
values_to = "proportion")
library(ggplot2)
library(dplyr)
library(purrr)
library(patchwork)
library(cowplot)
countries <- c("mexico", "puerto rico", "dominican republic", "cuba")
prop_migration_cohort_speaks_english_long <- prop_migration_cohort_speaks_english %>%
pivot_longer(cols = -year_of_immigration_groups,
names_to = "country",
values_to = "proportion")
library(ggplot2)
library(dplyr)
library(purrr)
library(patchwork)
library(cowplot)
library(tidyverse)
countries <- c("mexico", "puerto rico", "dominican republic", "cuba")
prop_migration_cohort_speaks_english_long <- prop_migration_cohort_speaks_english %>%
pivot_longer(cols = -year_of_immigration_groups,
names_to = "country",
values_to = "proportion")
result_list <- list()
for (country in countries) {
prop_cohort_speaks_english_country <- us_df_2020 %>%
filter(country_string == country) %>%
group_by(year_of_immigration_groups) %>%
summarise(
mean_english_speaker = weighted.mean(english_speaker, perwt, na.rm = TRUE)
)
result_list[[country]] <- prop_cohort_speaks_english_country$mean_english_speaker
}
prop_migration_cohort_speaks_english <- data.frame(
year_of_immigration_groups = prop_cohort_speaks_english_country$year_of_immigration_groups,
do.call(cbind, result_list)
) %>%
mutate(year_of_immigration_groups = case_when(
year_of_immigration_groups == 1 ~ "Before 1965",
year_of_immigration_groups == 2 ~ "1965 - 1979",
year_of_immigration_groups == 3 ~ "1980 - 1999",
year_of_immigration_groups == 4 ~ "After 1999",
)) %>%
mutate(year_of_immigration_groups = factor(year_of_immigration_groups,
levels = c("Before 1965", "1965 - 1979", "1980-1999", "After 1999")))
library(haven)
library(tidyverse)
library(xtable)
library(kableExtra)
library(readxl)
library(officer)
library(broom)
library(writexl)
library(scales)
countries <- c("mexico", "puerto rico", "dominican republic", "cuba")
result_list <- list()
for (country in countries) {
prop_cohort_speaks_english_country <- us_df_2020 %>%
filter(country_string == country) %>%
group_by(age_groups) %>%
summarise(
mean_english_speaker = weighted.mean(english_speaker, perwt, na.rm = TRUE)
)
# Store the result in the list
result_list[[country]] <- prop_cohort_speaks_english_country$mean_english_speaker
}
prop_cohort_speaks_english <- data.frame(
age_groups = prop_cohort_speaks_english_country$age_groups,
do.call(cbind, result_list)
) %>%
mutate(age_groups = case_when(
age_groups == 1 ~ "60 - 69",
age_groups == 2 ~ "70 - 79",
age_groups == 3 ~ "80 - 89"
))
print(prop_cohort_speaks_english)
result_list <- list()
for (country in countries) {
prop_cohort_speaks_english_country <- us_df_2020 %>%
filter(country_string == country) %>%
group_by(year_of_immigration_groups) %>%
summarise(
mean_english_speaker = weighted.mean(english_speaker, perwt, na.rm = TRUE)
)
result_list[[country]] <- prop_cohort_speaks_english_country$mean_english_speaker
}
prop_migration_cohort_speaks_english <- data.frame(
year_of_immigration_groups = prop_cohort_speaks_english_country$year_of_immigration_groups,
do.call(cbind, result_list)
) %>%
mutate(year_of_immigration_groups = case_when(
year_of_immigration_groups == 1 ~ "Before 1965",
year_of_immigration_groups == 2 ~ "1965 - 1979",
year_of_immigration_groups == 3 ~ "1980 - 1999",
year_of_immigration_groups == 4 ~ "After 1999",
)) %>%
mutate(year_of_immigration_groups = factor(year_of_immigration_groups,
levels = c("Before 1965", "1965 - 1979", "1980-1999", "After 1999")))
print(prop_migration_cohort_speaks_english)
target_dir <- normalizePath("/Users/chrissoria/Documents/Research/us_international_ses/plots")
current_dir <- normalizePath(getwd())
if (current_dir == target_dir) {
out_dir <- file.path("/Users/chrissoria/Documents/Research/us_international_ses/plots/")
data_dir <- file.path("/Users/chrissoria/Documents/Research/us_international_ses/data/")
plot_dir <- file.path("/Users/chrissoria/Documents/Research/us_international_ses//plots/")
} else {
out_dir <- file.path("C:/Users/Ty/Desktop/ses_international/plots//")
data_dir <- file.path("C:/Users/Ty/Desktop/ses_international/data//")
plot_dir <- file.path("C:/Users/Ty/Desktop/ses_international/plots//")
}
print(getwd())
countries <- c("mexico", "puerto rico", "dominican republic", "cuba")
prop_migration_cohort_speaks_english_long <- prop_migration_cohort_speaks_english %>%
pivot_longer(cols = -year_of_immigration_groups,
names_to = "country",
values_to = "proportion")
create_country_plot <- function(country_data) {
ggplot(country_data, aes(x = proportion, y = year_of_immigration_groups, fill = year_of_immigration_groups)) +
geom_bar(stat = "identity") +
geom_text(aes(label = scales::percent(proportion, accuracy = 0.1)),
hjust = -0.1, size = 3) +
scale_x_continuous(labels = scales::percent, limits = c(0, 1)) +
scale_fill_manual(name = "Cohort",
values = c("Before 1965" = "lightgreen",
"1965 - 1979" = "red",
"1980 - 1999" = "orange",
"After 1999" = "skyblue")) +
labs(title = str_to_title(unique(country_data$country)),
x = element_blank(),
y = element_blank()) +
theme_cowplot() +
theme(plot.title = element_text(hjust = 0.5),
legend.position = "none")  # Remove legend if not needed
}
country_plots <- prop_migration_cohort_speaks_english_long %>%
split(.$country) %>%
map(create_country_plot)
library(ggplot2)
library(dplyr)
library(purrr)
library(patchwork)
library(cowplot)
countries <- c("mexico", "puerto rico", "dominican republic", "cuba")
prop_migration_cohort_speaks_english_long <- prop_migration_cohort_speaks_english %>%
pivot_longer(cols = -year_of_immigration_groups,
names_to = "country",
values_to = "proportion")
create_country_plot <- function(country_data) {
ggplot(country_data, aes(x = proportion, y = year_of_immigration_groups, fill = year_of_immigration_groups)) +
geom_bar(stat = "identity") +
geom_text(aes(label = scales::percent(proportion, accuracy = 0.1)),
hjust = -0.1, size = 3) +
scale_x_continuous(labels = scales::percent, limits = c(0, 1)) +
scale_fill_manual(name = "Cohort",
values = c("Before 1965" = "lightgreen",
"1965 - 1979" = "red",
"1980 - 1999" = "orange",
"After 1999" = "skyblue")) +
labs(title = str_to_title(unique(country_data$country)),
x = element_blank(),
y = element_blank()) +
theme_cowplot() +
theme(plot.title = element_text(hjust = 0.5),
legend.position = "none")  # Remove legend if not needed
}
country_plots <- prop_migration_cohort_speaks_english_long %>%
split(.$country) %>%
map(create_country_plot)
combined_plot <- wrap_plots(country_plots, ncol = 2) +
plot_annotation(
title = "Proportion of English Speakers by Immigration Cohort and Country of Origin",
subtitle = "Based on 2020 dataset",
theme = theme(plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5))
) &
theme(legend.position = "bottom")
combined_plot_migration_cohort <- combined_plot +
plot_layout(guides = "collect") &
theme(legend.position = "bottom")
print(combined_plot_migration_cohort)
ggsave(filename = paste0(out_dir,"migration_cohort_english_speaker_panels.jpg"), plot = combined_plot_migration_cohort, width = 12, height = 9, dpi = 300)
result_list <- list()
for (country in countries) {
prop_cohort_speaks_english_country <- us_df_2020 %>%
filter(country_string == country) %>%
group_by(year_of_immigration_groups) %>%
summarise(
mean_english_speaker = weighted.mean(english_speaker, perwt, na.rm = TRUE)
)
result_list[[country]] <- prop_cohort_speaks_english_country$mean_english_speaker
}
prop_migration_cohort_speaks_english <- data.frame(
year_of_immigration_groups = prop_cohort_speaks_english_country$year_of_immigration_groups,
do.call(cbind, result_list)
) %>%
mutate(year_of_immigration_groups = case_when(
year_of_immigration_groups == 1 ~ "Before 1965",
year_of_immigration_groups == 2 ~ "1965 - 1979",
year_of_immigration_groups == 3 ~ "1980 - 1999",
year_of_immigration_groups == 4 ~ "After 1999",
)) %>%
mutate(year_of_immigration_groups = factor(year_of_immigration_groups,
levels = c("Before 1965", "1965 - 1979", "1980 - 1999", "After 1999")))
print(prop_migration_cohort_speaks_english)
countries <- c("mexico", "puerto rico", "dominican republic", "cuba")
prop_migration_cohort_speaks_english_long <- prop_migration_cohort_speaks_english %>%
pivot_longer(cols = -year_of_immigration_groups,
names_to = "country",
values_to = "proportion")
create_country_plot <- function(country_data) {
ggplot(country_data, aes(x = proportion, y = year_of_immigration_groups, fill = year_of_immigration_groups)) +
geom_bar(stat = "identity") +
geom_text(aes(label = scales::percent(proportion, accuracy = 0.1)),
hjust = -0.1, size = 3) +
scale_x_continuous(labels = scales::percent, limits = c(0, 1)) +
scale_fill_manual(name = "Cohort",
values = c("Before 1965" = "lightgreen",
"1965 - 1979" = "red",
"1980 - 1999" = "orange",
"After 1999" = "skyblue")) +
labs(title = str_to_title(unique(country_data$country)),
x = element_blank(),
y = element_blank()) +
theme_cowplot() +
theme(plot.title = element_text(hjust = 0.5),
legend.position = "none")  # Remove legend if not needed
}
country_plots <- prop_migration_cohort_speaks_english_long %>%
split(.$country) %>%
map(create_country_plot)
combined_plot <- wrap_plots(country_plots, ncol = 2) +
plot_annotation(
title = "Proportion of English Speakers by Immigration Cohort and Country of Origin",
subtitle = "Based on 2020 dataset",
theme = theme(plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5))
) &
theme(legend.position = "bottom")
combined_plot_migration_cohort <- combined_plot +
plot_layout(guides = "collect") &
theme(legend.position = "bottom")
print(combined_plot_migration_cohort)
ggsave(filename = paste0(out_dir,"migration_cohort_english_speaker_panels.jpg"), plot = combined_plot_migration_cohort, width = 12, height = 9, dpi = 300)
