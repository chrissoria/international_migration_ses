results_list <- list()
# running the models
for (dv in dvs) {
# conditionally modify countries for filtering
current_countries <- if (dv == "is_naturalized_citizen") {
c("mexico", "dominican republic", "cuba")  # exclude when pr when dv is citizen
} else {
c("mexico", "puerto rico", "dominican republic", "cuba")
}
# conditionally modify ivs
current_ivs <- if (dv == "less_than_primary_completed") {
ivs[!ivs %in% "secondary_or_above"]
} else {
ivs
}
# filter data with conditional countries
us_df_all_filtered <- us_df_all %>%
filter(country_string %in% current_countries) %>%
mutate(country_string = fct_relevel(country_string, "mexico"))
formula <- as.formula(paste(dv, "~", paste(current_ivs, collapse = " + ")))
print(formula)
model <- lm(formula, data = us_df_2020_filtered,
weights = perwt)
results_list[[dv]] <- model
}
summaries <- map(results_list, summary)
for (reason in names(summaries)) {
cat("\n\n", "Summary for", reason, ":\n")
print(summaries[[reason]])
}
excel_data <- list()
# Loop through each model in results_list
for (reason in names(results_list)) {
if (!is.null(results_list[[reason]])) {
model_summary <- tidy(results_list[[reason]])
excel_data[[reason]] <- model_summary
} else {
cat("\n\n", "No valid model for", reason, "\n")
}
}
if (length(excel_data) > 0) {
write_xlsx(excel_data, path = paste0(out_dir, "../regressions/2020_US_model_summaries_all_controls.xlsx"))
} else {
cat("No valid data to write to Excel.\n")
}
dvs <- c("married_cohab", "lives_alone", "english_speaker", "secondary_or_above", "is_naturalized_citizen", "less_than_primary_completed")
ivs <- c("age_at_immigration_15to24","age_at_immigration_25to49", "age_at_immigration_50plus", "yrimm_before1965", "yrimm_1965to1980", "yrimm_1980to1999", "female", "country_string", "english_speaker", "secondary_or_above", "age_70to79", "age_80to89", "age_90plus", "country_string*year")
results_list <- list()
# running the models
for (dv in dvs) {
# conditionally modify countries for filtering
current_countries <- if (dv == "is_naturalized_citizen") {
c("mexico", "dominican republic", "cuba")  # exclude when pr when dv is citizen
} else {
c("mexico", "puerto rico", "dominican republic", "cuba")
}
# conditionally modify ivs
current_ivs <- if (dv == "less_than_primary_completed") {
ivs[!ivs %in% "secondary_or_above"]
} else {
ivs
}
# filter data with conditional countries
us_df_all_filtered <- us_df_all %>%
filter(country_string %in% current_countries) %>%
mutate(country_string = fct_relevel(country_string, "mexico"))
formula <- as.formula(paste(dv, "~", paste(current_ivs, collapse = " + ")))
print(formula)
model <- lm(formula, data = us_df_all_filtered,
weights = perwt)
results_list[[dv]] <- model
}
target_dir <- normalizePath("/Users/chrissoria/Documents/Research/us_international_ses/tables/r_tables")
current_dir <- normalizePath(getwd())
if (current_dir == target_dir) {
out_dir <- file.path("/Users/chrissoria/Documents/Research/us_international_ses/tables/r_tables/")
data_dir <- file.path("/Users/chrissoria/Documents/Research/us_international_ses/data/")
plot_dir <- file.path("/Users/chrissoria/Documents/Research/us_international_ses/plots/")
} else {
out_dir <- file.path("C:/Users/Ty/Desktop/ses_international/tables/r_tables//")
data_dir <- file.path("C:/Users/Ty/Desktop/ses_international/data//")
plot_dir <- file.path("C:/Users/Ty/Desktop/ses_international/plots//")
}
print(getwd())
us_df_2010_filtered <- us_df_2010 %>%
filter(country_string %in% c("mexico", "puerto rico", "dominican republic", "cuba")) %>%
mutate(country_string = fct_relevel(country_string, "mexico"),
year = haven::as_factor(year)) %>%
select(married_cohab, age_at_immigration_15to24, age_at_immigration_25to49, age_at_immigration_50plus,
yrimm_before1965, yrimm_1965to1980, yrimm_1980to1999, female,
country_string, lives_alone, english_speaker, secondary_or_above,
age_70to79, age_80to89, age_90plus, perwt, year, is_naturalized_citizen, less_than_primary_completed)
us_df_2020_filtered <- us_df_2020 %>%
filter(country_string %in% c("mexico", "puerto rico", "dominican republic", "cuba")) %>%
mutate(country_string = fct_relevel(country_string, "mexico"),
year = haven::as_factor(year)) %>%
select(married_cohab, age_at_immigration_15to24, age_at_immigration_25to49, age_at_immigration_50plus,
yrimm_before1965, yrimm_1965to1980, yrimm_1980to1999, female,
country_string, lives_alone, english_speaker, secondary_or_above,
age_70to79, age_80to89, age_90plus, perwt, year, is_naturalized_citizen, less_than_primary_completed)
us_df_all <- rbind(us_df_2010_filtered, us_df_2020_filtered)
dvs <- c("married_cohab", "lives_alone", "english_speaker", "secondary_or_above", "is_naturalized_citizen", "less_than_primary_completed")
ivs <- c("country_string*year")  # corrected
results_list <- list()
# running the models
for (dv in dvs) {
current_countries <- if (dv == "is_naturalized_citizen") {
c("mexico", "dominican republic", "cuba")  # exclude when pr when dv is citizen
} else {
c("mexico", "puerto rico", "dominican republic", "cuba")
}
us_df_all_filtered <- us_df_all %>%
filter(country_string %in% current_countries) %>%
mutate(country_string = fct_relevel(country_string, "mexico"))
formula <- as.formula(paste(dv, "~", paste(ivs, collapse = " + ")))
print(formula)
model <- lm(formula, data = us_df_all_filtered,
weights = perwt)
results_list[[dv]] <- model
}
summaries <- map(results_list, summary)
for (reason in names(summaries)) {
cat("\n\n", "Summary for", reason, ":\n")
print(summaries[[reason]])
}
excel_data <- list()
for (reason in names(results_list)) {
if (!is.null(results_list[[reason]])) {
model_summary <- tidy(results_list[[reason]])
excel_data[[reason]] <- model_summary
} else {
cat("\n\n", "No valid model for", reason, "\n")
}
}
if (length(excel_data) > 0) {
write_xlsx(excel_data, path = paste0(out_dir, "../regressions/2020_US_model_summaries_no_controls_interaction.xlsx"))
} else {
cat("No valid data to write to Excel.\n")
}
dvs <- c("married_cohab", "lives_alone", "english_speaker", "secondary_or_above", "is_naturalized_citizen", "less_than_primary_completed")
ivs <- c("age_at_immigration_15to24","age_at_immigration_25to49", "age_at_immigration_50plus", "yrimm_before1965", "yrimm_1965to1980", "yrimm_1980to1999", "female", "country_string", "english_speaker", "secondary_or_above", "age_70to79", "age_80to89", "age_90plus", "country_string*year")
results_list <- list()
# running the models
for (dv in dvs) {
# conditionally modify countries for filtering
current_countries <- if (dv == "is_naturalized_citizen") {
c("mexico", "dominican republic", "cuba")  # exclude when pr when dv is citizen
} else {
c("mexico", "puerto rico", "dominican republic", "cuba")
}
# conditionally modify ivs
current_ivs <- if (dv == "less_than_primary_completed") {
ivs[!ivs %in% "secondary_or_above"]
} else {
ivs
}
# filter data with conditional countries
us_df_all_filtered <- us_df_all %>%
filter(country_string %in% current_countries) %>%
mutate(country_string = fct_relevel(country_string, "mexico"))
formula <- as.formula(paste(dv, "~", paste(current_ivs, collapse = " + ")))
print(formula)
model <- lm(formula, data = us_df_all_filtered,
weights = perwt)
results_list[[dv]] <- model
}
summaries <- map(results_list, summary)
for (reason in names(summaries)) {
cat("\n\n", "Summary for", reason, ":\n")
print(summaries[[reason]])
}
excel_data <- list()
# Loop through each model in results_list
for (reason in names(results_list)) {
if (!is.null(results_list[[reason]])) {
model_summary <- tidy(results_list[[reason]])
excel_data[[reason]] <- model_summary
} else {
cat("\n\n", "No valid model for", reason, "\n")
}
}
if (length(excel_data) > 0) {
write_xlsx(excel_data, path = paste0(out_dir, "../regressions/2020_US_model_summaries_all_controls.xlsx"))
} else {
cat("No valid data to write to Excel.\n")
}
dvs <- c("married_cohab", "lives_alone", "english_speaker", "secondary_or_above", "is_naturalized_citizen", "less_than_primary_completed")
ivs <- c("age_at_immigration_15to24","age_at_immigration_25to49", "age_at_immigration_50plus", "yrimm_before1965", "yrimm_1965to1980", "yrimm_1980to1999", "female", "country_string", "english_speaker", "secondary_or_above", "age_70to79", "age_80to89", "age_90plus", "country_string*year")
results_list <- list()
# running the models
for (dv in dvs) {
# conditionally modify countries for filtering
current_countries <- if (dv == "is_naturalized_citizen") {
c("mexico", "dominican republic", "cuba")  # exclude when pr when dv is citizen
} else {
c("mexico", "puerto rico", "dominican republic", "cuba")
}
# conditionally modify ivs
current_ivs <- if (dv == "less_than_primary_completed") {
ivs[!ivs %in% "secondary_or_above"]
} else {
ivs
}
# filter data with conditional countries
us_df_all_filtered <- us_df_all %>%
filter(country_string %in% current_countries) %>%
mutate(country_string = fct_relevel(country_string, "mexico"))
formula <- as.formula(paste(dv, "~", paste(current_ivs, collapse = " + ")))
print(formula)
model <- lm(formula, data = us_df_all_filtered,
weights = perwt)
results_list[[dv]] <- model
}
summaries <- map(results_list, summary)
for (reason in names(summaries)) {
cat("\n\n", "Summary for", reason, ":\n")
print(summaries[[reason]])
}
excel_data <- list()
# Loop through each model in results_list
for (reason in names(results_list)) {
if (!is.null(results_list[[reason]])) {
model_summary <- tidy(results_list[[reason]])
excel_data[[reason]] <- model_summary
} else {
cat("\n\n", "No valid model for", reason, "\n")
}
}
if (length(excel_data) > 0) {
write_xlsx(excel_data, path = paste0(out_dir, "../regressions/2020_US_model_summaries_all_controls_interaction.xlsx"))
} else {
cat("No valid data to write to Excel.\n")
}
dvs <- c("married_cohab", "lives_alone", "english_speaker", "secondary_or_above", "is_naturalized_citizen", "less_than_primary_completed")
ivs <- c("age_at_immigration_15to24","age_at_immigration_25to49", "age_at_immigration_50plus", "yrimm_before1965", "yrimm_1965to1980", "yrimm_1980to1999", "female", "country_string", "english_speaker", "secondary_or_above", "age_70to79", "age_80to89", "age_90plus")
results_list <- list()
# running the models
for (dv in dvs) {
# conditionally modify countries for filtering
current_countries <- if (dv == "is_naturalized_citizen") {
c("mexico", "dominican republic", "cuba")  # exclude when pr when dv is citizen
} else {
c("mexico", "puerto rico", "dominican republic", "cuba")
}
# conditionally modify ivs
current_ivs <- if (dv == "less_than_primary_completed") {
ivs[!ivs %in% "secondary_or_above"]
} else {
ivs
}
# filter data with conditional countries
us_df_2020_filtered <- us_df_2020 %>%
filter(country_string %in% current_countries) %>%
mutate(country_string = fct_relevel(country_string, "mexico"))
formula <- as.formula(paste(dv, "~", paste(current_ivs, collapse = " + ")))
print(formula)
model <- lm(formula, data = us_df_2020_filtered,
weights = perwt)
results_list[[dv]] <- model
}
summaries <- map(results_list, summary)
for (reason in names(summaries)) {
cat("\n\n", "Summary for", reason, ":\n")
print(summaries[[reason]])
}
excel_data <- list()
# Loop through each model in results_list
for (reason in names(results_list)) {
if (!is.null(results_list[[reason]])) {
model_summary <- tidy(results_list[[reason]])
excel_data[[reason]] <- model_summary
} else {
cat("\n\n", "No valid model for", reason, "\n")
}
}
if (length(excel_data) > 0) {
write_xlsx(excel_data, path = paste0(out_dir, "../regressions/2020_US_model_summaries_all_controls.xlsx"))
} else {
cat("No valid data to write to Excel.\n")
}
dvs <- c("married_cohab", "lives_alone", "english_speaker", "secondary_or_above", "is_naturalized_citizen", "less_than_primary_completed")
ivs <- c("age_at_immigration_15to24","age_at_immigration_25to49", "age_at_immigration_50plus", "yrimm_before1965", "yrimm_1965to1980", "yrimm_1980to1999", "female", "country_string", "english_speaker", "secondary_or_above", "age_70to79", "age_80to89", "age_90plus", "country_string*year")
results_list <- list()
# running the models
for (dv in dvs) {
# conditionally modify countries for filtering
current_countries <- if (dv == "is_naturalized_citizen") {
c("mexico", "dominican republic", "cuba")  # exclude when pr when dv is citizen
} else {
c("mexico", "puerto rico", "dominican republic", "cuba")
}
# conditionally modify ivs
current_ivs <- if (dv == "less_than_primary_completed") {
ivs[!ivs %in% "secondary_or_above"]
} else {
ivs
}
# filter data with conditional countries
us_df_all_filtered <- us_df_all %>%
filter(country_string %in% current_countries) %>%
mutate(country_string = fct_relevel(country_string, "mexico"))
formula <- as.formula(paste(dv, "~", paste(current_ivs, collapse = " + ")))
print(formula)
model <- lm(formula, data = us_df_all_filtered,
weights = perwt)
results_list[[dv]] <- model
}
summaries <- map(results_list, summary)
for (reason in names(summaries)) {
cat("\n\n", "Summary for", reason, ":\n")
print(summaries[[reason]])
}
excel_data <- list()
# Loop through each model in results_list
for (reason in names(results_list)) {
if (!is.null(results_list[[reason]])) {
model_summary <- tidy(results_list[[reason]])
excel_data[[reason]] <- model_summary
} else {
cat("\n\n", "No valid model for", reason, "\n")
}
}
if (length(excel_data) > 0) {
write_xlsx(excel_data, path = paste0(out_dir, "../regressions/2020_US_model_summaries_all_controls_interaction.xlsx"))
} else {
cat("No valid data to write to Excel.\n")
}
dvs <- c("cognitive_difficulty", "independent_living_difficulty")
ivs <- c("married_cohab", "age_at_immigration_25to49", "age_at_immigration_50plus", "yrimm_before1965", "yrimm_1965to1980", "yrimm_1980to1999", "female",  "country_string", "lives_alone", "english_speaker", "secondary_or_above", "age_70to79", "age_80to89", "age_90plus")
us_df_2020_filtered <- us_df_2020 %>%
filter(country_string %in% c("mexico", "puerto rico", "dominican republic", "cuba")) %>%
mutate(country_string = fct_relevel(country_string, "mexico"))
results_list <- list()
# running the models
for (dv in dvs) {
formula <- as.formula(paste(dv, "~", paste(ivs, collapse = " + ")))
print(formula)
model <- lm(formula, data = us_df_2020_filtered,  # corrected data frame name
weights = perwt)
results_list[[dv]] <- model
}
summaries <- map(results_list, summary)
for (reason in names(summaries)) {
cat("\n\n", "Summary for", reason, ":\n")
print(summaries[[reason]])
}
excel_data <- list()
for (reason in names(results_list)) {
if (!is.null(results_list[[reason]])) {
model_summary <- tidy(results_list[[reason]])
excel_data[[reason]] <- model_summary
} else {
cat("\n\n", "No valid model for", reason, "\n")
}
}
if (length(excel_data) > 0) {
write_xlsx(excel_data, path = paste0(out_dir, "../regressions/within_US_model_summaries.xlsx"))
} else {
cat("No valid data to write to Excel.\n")
}
dvs <- c("cognitive_difficulty", "independent_living_difficulty")
ivs <- c("married_cohab", "age_at_immigration_25to49", "age_at_immigration_50plus", "yrimm_before1965", "yrimm_1965to1980", "yrimm_1980to1999", "female",  "country_string", "lives_alone", "english_speaker", "secondary_or_above", "age_70to79", "age_80to89", "age_90plus")
us_df_2020_filtered <- us_df_2020 %>%
filter(country_string %in% c("mexico", "puerto rico", "dominican republic", "cuba")) %>%
mutate(country_string = fct_relevel(country_string, "mexico"))
results_list <- list()
# running the models
for (dv in dvs) {
formula <- as.formula(paste(dv, "~", paste(ivs, collapse = " + ")))
print(formula)
model <- lm(formula, data = us_df_2020_filtered,  # corrected data frame name
weights = perwt)
results_list[[dv]] <- model
}
current_ivs <- if (dv == "less_than_primary_completed") {
ivs[!ivs %in% "secondary_or_above"]
} else {
ivs
}
summaries <- map(results_list, summary)
for (reason in names(summaries)) {
cat("\n\n", "Summary for", reason, ":\n")
print(summaries[[reason]])
}
excel_data <- list()
for (reason in names(results_list)) {
if (!is.null(results_list[[reason]])) {
model_summary <- tidy(results_list[[reason]])
excel_data[[reason]] <- model_summary
} else {
cat("\n\n", "No valid model for", reason, "\n")
}
}
if (length(excel_data) > 0) {
write_xlsx(excel_data, path = paste0(out_dir, "../regressions/within_US_model_summaries.xlsx"))
} else {
cat("No valid data to write to Excel.\n")
}
dvs <- c("married_cohab", "lives_alone", "english_speaker", "secondary_or_above", "is_naturalized_citizen", "less_than_primary_completed")
ivs <- c("country_string*year")  # corrected
results_list <- list()
# running the models
for (dv in dvs) {
current_countries <- if (dv == "is_naturalized_citizen") {
c("mexico", "dominican republic", "cuba")  # exclude when pr when dv is citizen
} else {
c("mexico", "puerto rico", "dominican republic", "cuba")
}
us_df_all_filtered <- us_df_all %>%
filter(country_string %in% current_countries) %>%
mutate(country_string = fct_relevel(country_string, "mexico"))
formula <- as.formula(paste(dv, "~", paste(ivs, collapse = " + ")))
print(formula)
model <- lm(formula, data = us_df_all_filtered,
weights = perwt)
results_list[[dv]] <- model
}
summaries <- map(results_list, summary)
for (reason in names(summaries)) {
cat("\n\n", "Summary for", reason, ":\n")
print(summaries[[reason]])
}
excel_data <- list()
for (reason in names(results_list)) {
if (!is.null(results_list[[reason]])) {
model_summary <- tidy(results_list[[reason]])
excel_data[[reason]] <- model_summary
} else {
cat("\n\n", "No valid model for", reason, "\n")
}
}
if (length(excel_data) > 0) {
write_xlsx(excel_data, path = paste0(out_dir, "../regressions/2020_US_model_summaries_no_controls_interaction.xlsx"))
} else {
cat("No valid data to write to Excel.\n")
}
dvs <- c("married_cohab", "lives_alone", "english_speaker", "secondary_or_above", "is_naturalized_citizen", "less_than_primary_completed")
ivs <- c("country_string")
results_list <- list()
# running the models
for (dv in dvs) {
current_countries <- if (dv == "is_naturalized_citizen") {
c("mexico", "dominican republic", "cuba")  # exclude when pr when dv is citizen
} else {
c("mexico", "puerto rico", "dominican republic", "cuba")
}
us_df_2020_filtered <- us_df_2020 %>%
filter(country_string %in% current_countries) %>%
mutate(country_string = fct_relevel(country_string, "mexico"))
formula <- as.formula(paste(dv, "~", paste(ivs, collapse = " + ")))
print(formula)
model <- lm(formula, data = us_df_2010_filtered,
weights = perwt)
results_list[[dv]] <- model
}
summaries <- map(results_list, summary)
for (reason in names(summaries)) {
cat("\n\n", "Summary for", reason, ":\n")
print(summaries[[reason]])
}
excel_data <- list()
# Loop through each model in results_list
for (reason in names(results_list)) {
if (!is.null(results_list[[reason]])) {
model_summary <- tidy(results_list[[reason]])
excel_data[[reason]] <- model_summary
} else {
cat("\n\n", "No valid model for", reason, "\n")
}
}
if (length(excel_data) > 0) {
write_xlsx(excel_data, path = paste0(out_dir, "../regressions/2020_US_model_summaries_no_controls.xlsx"))
} else {
cat("No valid data to write to Excel.\n")
}
dvs <- c("married_cohab", "lives_alone", "english_speaker", "secondary_or_above", "is_naturalized_citizen", "less_than_primary_completed")
ivs <- c("country_string")
results_list <- list()
for (dv in dvs) {
current_countries <- if (dv == "is_naturalized_citizen") {
c("mexico", "dominican republic", "cuba")  # exclude when pr when dv is citizen
} else {
c("mexico", "puerto rico", "dominican republic", "cuba")
}
us_df_2020_filtered <- us_df_2020 %>%
filter(country_string %in% current_countries) %>%
mutate(country_string = fct_relevel(country_string, "mexico"))
formula <- as.formula(paste(dv, "~", paste(ivs, collapse = " + ")))
print(formula)
model <- lm(formula, data = us_df_2020_filtered,  # corrected: use 2020 version
weights = perwt)
results_list[[dv]] <- model
}
summaries <- map(results_list, summary)
for (reason in names(summaries)) {
cat("\n\n", "Summary for", reason, ":\n")
print(summaries[[reason]])
}
excel_data <- list()
for (reason in names(results_list)) {
if (!is.null(results_list[[reason]])) {
model_summary <- tidy(results_list[[reason]])
excel_data[[reason]] <- model_summary
} else {
cat("\n\n", "No valid model for", reason, "\n")
}
}
if (length(excel_data) > 0) {
write_xlsx(excel_data, path = paste0(out_dir, "../regressions/2020_US_model_summaries_no_controls.xlsx"))
} else {
cat("No valid data to write to Excel.\n")
}
